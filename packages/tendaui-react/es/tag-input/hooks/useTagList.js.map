{"version":3,"file":"useTagList.js","sources":["../../../../components/tag-input/hooks/useTagList.tsx"],"sourcesContent":["import React, {\r\n  useState,\r\n  MouseEvent,\r\n  KeyboardEvent,\r\n  ReactNode,\r\n  Fragment,\r\n} from 'react';\r\nimport { isFunction } from 'lodash-es';\r\nimport { TagInputChangeContext, TagInputValue, TdTagInputProps } from '../type';\r\nimport { InputValue } from '../../input';\r\nimport { Tag } from '../../tag';\r\nimport useConfig from '../../hooks/useConfig';\r\nimport useControlled from '../../hooks/useControlled';\r\nimport { DragSortInnerProps } from '../../hooks/useDragSorter';\r\n\r\nexport type ChangeParams = [TagInputChangeContext];\r\n\r\ninterface TagInputProps extends TdTagInputProps, DragSortInnerProps {\r\n  options?: any[]; // 参数穿透options, 给SelectInput/SelectInput 自定义选中项呈现的内容和多选状态下设置折叠项内容\r\n}\r\n\r\nexport default function useTagList(props: TagInputProps) {\r\n  const { classPrefix: prefix } = useConfig();\r\n  const {\r\n    onRemove,\r\n    max,\r\n    minCollapsedNum,\r\n    size,\r\n    disabled,\r\n    readonly,\r\n    tagProps,\r\n    tag,\r\n    collapsedItems,\r\n    getDragProps,\r\n  } = props;\r\n  const [tagValue, setTagValue] = useControlled(props, 'value', props.onChange);\r\n  const [oldInputValue, setOldInputValue] = useState<InputValue>();\r\n\r\n  const onClose = (p: { e?: MouseEvent<SVGSVGElement>; index: number }) => {\r\n    const arr = [...tagValue];\r\n    const [item] = arr.splice(p.index, 1);\r\n    setTagValue(arr, { trigger: 'tag-remove', ...p, item });\r\n    onRemove?.({ ...p, item, trigger: 'tag-remove', value: arr });\r\n  };\r\n\r\n  const clearAll = (context: { e: MouseEvent<SVGSVGElement> }) => {\r\n    setTagValue([], { trigger: 'clear', e: context.e });\r\n  };\r\n\r\n  // 按下 Enter 键，新增标签\r\n  const onInnerEnter = (\r\n    value: InputValue,\r\n    context: { e: KeyboardEvent<HTMLInputElement> },\r\n  ) => {\r\n    const valueStr = value ? String(value).trim() : '';\r\n    let newValue: TagInputValue = tagValue;\r\n    const isLimitExceeded = max && tagValue?.length >= max;\r\n    if (valueStr && !isLimitExceeded) {\r\n      newValue =\r\n        tagValue instanceof Array\r\n          ? tagValue.concat(String(valueStr))\r\n          : [valueStr];\r\n      setTagValue(newValue, {\r\n        trigger: 'enter',\r\n        index: newValue.length - 1,\r\n        item: valueStr,\r\n        e: context.e,\r\n      });\r\n    }\r\n    props?.onEnter?.(newValue, { ...context, inputValue: value });\r\n  };\r\n\r\n  const onInputBackspaceKeyUp = (value: InputValue) => {\r\n    if (!tagValue || !tagValue.length) return;\r\n    setOldInputValue(value);\r\n  };\r\n\r\n  // 按下回退键，删除标签\r\n  const onInputBackspaceKeyDown = (\r\n    value: InputValue,\r\n    context: { e: KeyboardEvent<HTMLInputElement> },\r\n  ) => {\r\n    const { e } = context;\r\n    if (!tagValue || !tagValue.length || readonly) return;\r\n    // 回车键删除，输入框值为空时，才允许 Backspace 删除标签\r\n    if (!value && ['Backspace', 'NumpadDelete'].includes(e.key)) {\r\n      const index = tagValue.length - 1;\r\n      const item = tagValue[index];\r\n      const trigger = 'backspace';\r\n      const newValue = tagValue.slice(0, -1);\r\n      setTagValue(newValue, { e, index, item, trigger });\r\n      onRemove?.({ e, index, item, trigger, value: newValue });\r\n    }\r\n  };\r\n\r\n  const renderLabel = ({\r\n    displayNode,\r\n    label,\r\n  }: {\r\n    displayNode: ReactNode;\r\n    label: ReactNode;\r\n  }) => {\r\n    const newList = minCollapsedNum\r\n      ? tagValue.slice(0, minCollapsedNum)\r\n      : tagValue;\r\n\r\n    const list = displayNode\r\n      ? [<Fragment key=\"display-node\">{displayNode}</Fragment>]\r\n      : newList?.map((item, index) => {\r\n        const tagContent = isFunction(tag) ? tag({ value: item }) : tag;\r\n        return (\r\n          <Tag\r\n            key={index}\r\n            size={size}\r\n            disabled={disabled}\r\n            onClose={(context) => onClose({ e: context.e, index })}\r\n            closable={!readonly && !disabled}\r\n            {...getDragProps?.(index, item)}\r\n            {...tagProps}\r\n          >\r\n            {tagContent ?? item}\r\n          </Tag>\r\n        );\r\n      });\r\n    if (label) {\r\n      list?.unshift(\r\n        <div className={`${prefix}-tag-input__prefix`} key=\"label\">\r\n          {label}\r\n        </div>,\r\n      );\r\n    }\r\n    // 超出省略\r\n    if (newList.length !== tagValue.length) {\r\n      const len = tagValue.length - newList.length;\r\n      // 这里会从selectInput/SelectInput中传递options参数，用于自定义选中项呈现的内容和多选状态下设置折叠项内容\r\n      const options = Array.isArray(props?.options) ? props.options : tagValue;\r\n      const params = {\r\n        value: tagValue,\r\n        count: tagValue.length - minCollapsedNum,\r\n        collapsedTags: tagValue.slice(minCollapsedNum, tagValue.length),\r\n        collapsedSelectedItems: options.slice(minCollapsedNum, tagValue.length),\r\n        onClose,\r\n      };\r\n      const more = isFunction(collapsedItems)\r\n        ? collapsedItems(params)\r\n        : collapsedItems;\r\n      list.push(\r\n        <Fragment key=\"more\">\r\n          {more ?? (\r\n            <Tag size={size} {...tagProps}>\r\n              +{len}\r\n            </Tag>\r\n          )}\r\n        </Fragment>,\r\n      );\r\n    }\r\n    return list;\r\n  };\r\n  return {\r\n    tagValue,\r\n    clearAll,\r\n    onClose,\r\n    onInnerEnter,\r\n    onInputBackspaceKeyDown,\r\n    onInputBackspaceKeyUp,\r\n    renderLabel,\r\n  };\r\n}\r\n"],"names":["useTagList","props","_useConfig","useConfig","prefix","classPrefix","onRemove","max","minCollapsedNum","size","disabled","readonly","tagProps","tag","collapsedItems","getDragProps","_useControlled","useControlled","onChange","_useControlled2","_slicedToArray","tagValue","setTagValue","_useState","useState","_useState2","oldInputValue","setOldInputValue","onClose","p","arr","_toConsumableArray","_arr$splice","splice","index","_arr$splice2","item","_objectSpread","trigger","value","clearAll","context","e","onInnerEnter","_props$onEnter","valueStr","String","trim","newValue","isLimitExceeded","length","Array","concat","onEnter","call","inputValue","onInputBackspaceKeyUp","onInputBackspaceKeyDown","includes","key","slice","renderLabel","_ref","displayNode","label","newList","list","React","createElement","Fragment","map","tagContent","isFunction","Tag","_extends","closable","unshift","className","len","options","isArray","params","count","collapsedTags","collapsedSelectedItems","more","push"],"mappings":"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"}