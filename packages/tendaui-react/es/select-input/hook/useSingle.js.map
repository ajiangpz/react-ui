{"version":3,"file":"useSingle.js","sources":["../../../../components/select-input/hook/useSingle.tsx"],"sourcesContent":["import React, { useRef, MouseEvent } from 'react';\r\nimport { isObject, pick } from 'lodash-es';\r\nimport classNames from 'classnames';\r\nimport { SelectInputCommonProperties } from '../interface';\r\nimport { TdSelectInputProps } from '../type';\r\nimport Input, { InputProps, InputRef, TdInputProps } from '../../input';\r\nimport useControlled from '../../hooks/useControlled';\r\n\r\nexport interface RenderSelectSingleInputParams {\r\n  tPlaceholder: string;\r\n}\r\n\r\n// single 和 multiple 共有特性\r\nconst COMMON_PROPERTIES = [\r\n  'status',\r\n  'clearable',\r\n  'disabled',\r\n  'label',\r\n  'placeholder',\r\n  'readonly',\r\n  'suffix',\r\n  'suffixIcon',\r\n  'onPaste',\r\n  'onEnter',\r\n  'onMouseenter',\r\n  'onMouseleave',\r\n  'size',\r\n  'prefixIcon',\r\n];\r\n\r\nconst DEFAULT_KEYS: TdSelectInputProps['keys'] = {\r\n  label: 'label',\r\n  value: 'value',\r\n};\r\n\r\nfunction getInputValue(\r\n  value: TdSelectInputProps['value'],\r\n  keys: TdSelectInputProps['keys'],\r\n) {\r\n  const iKeys = keys || DEFAULT_KEYS;\r\n  return isObject(value) ? value[iKeys.label] : value;\r\n}\r\n\r\nexport default function useSingle(props: TdSelectInputProps) {\r\n  const { value, keys } = props;\r\n  const inputRef = useRef<InputRef>(null);\r\n  const [inputValue, setInputValue] = useControlled(\r\n    props,\r\n    'inputValue',\r\n    props.onInputChange,\r\n  );\r\n  const commonInputProps: SelectInputCommonProperties = {\r\n    ...pick(props, COMMON_PROPERTIES),\r\n    suffixIcon: props.suffixIcon,\r\n  };\r\n\r\n  const onInnerClear = (context: { e: MouseEvent<SVGSVGElement> }) => {\r\n    context?.e?.stopPropagation();\r\n    props.onClear?.(context);\r\n    setInputValue('', { trigger: 'clear' });\r\n  };\r\n\r\n  const onInnerInputChange: TdInputProps['onChange'] = (value, context) => {\r\n    if (props.allowInput) {\r\n      setInputValue(value, { ...context, trigger: 'input' });\r\n    }\r\n  };\r\n\r\n  const handleEmptyPanelBlur = (\r\n    value: string,\r\n    { e }: { e: React.FocusEvent<HTMLInputElement> },\r\n  ) => {\r\n    props.onBlur?.(value, { e, inputValue: value });\r\n  };\r\n\r\n  const renderSelectSingle = (popupVisible: boolean) => {\r\n    const singleValueDisplay = !props.multiple ? props.valueDisplay : null;\r\n    const displayedValue =\r\n      popupVisible && props.allowInput\r\n        ? inputValue\r\n        : getInputValue(value, keys);\r\n    return (\r\n      <Input\r\n        ref={inputRef}\r\n        {...(commonInputProps as InputProps)}\r\n        autoWidth={props.autoWidth}\r\n        placeholder={props.placeholder}\r\n        value={singleValueDisplay ? ' ' : displayedValue}\r\n        label={\r\n          (props.label || singleValueDisplay) && (\r\n            <>\r\n              {props.label}\r\n              {singleValueDisplay as React.ReactNode}\r\n            </>\r\n          )\r\n        }\r\n        onChange={onInnerInputChange}\r\n        onClear={onInnerClear}\r\n        // [Important Info]: SelectInput.blur is not equal to Input, example: click popup panel\r\n        onFocus={(val, context) => {\r\n          props.onFocus?.(value, { ...context, inputValue: val });\r\n          // focus might not need to change input value. it will caught some curious errors in tree-select\r\n          // !popupVisible && setInputValue(getInputValue(value, keys), { ...context, trigger: 'input' });\r\n        }}\r\n        onEnter={(val, context) => {\r\n          props.onEnter?.(value, { ...context, inputValue: val });\r\n        }}\r\n        // onBlur need to triggered by input when popup panel is null\r\n        onBlur={!props.panel ? handleEmptyPanelBlur : null}\r\n        {...props.inputProps}\r\n        inputClass={classNames(props.inputProps?.className, {\r\n          [`t-input--focused`]: popupVisible,\r\n          [`t-is-focused`]: popupVisible,\r\n        })}\r\n      ></Input>\r\n    );\r\n  };\r\n  return {\r\n    inputRef,\r\n    commonInputProps,\r\n    singleInputValue: inputValue,\r\n    onInnerClear,\r\n    renderSelectSingle,\r\n  };\r\n}\r\n"],"names":["COMMON_PROPERTIES","DEFAULT_KEYS","label","value","getInputValue","keys","iKeys","isObject","useSingle","props","inputRef","useRef","_useControlled","useControlled","onInputChange","_useControlled2","_slicedToArray","inputValue","setInputValue","commonInputProps","_objectSpread","pick","suffixIcon","onInnerClear","context","_context$e","_props$onClear","e","stopPropagation","onClear","call","trigger","onInnerInputChange","allowInput","handleEmptyPanelBlur","_ref","_props$onBlur","onBlur","renderSelectSingle","popupVisible","_props$inputProps","singleValueDisplay","multiple","valueDisplay","displayedValue","React","createElement","Input","_extends","ref","autoWidth","placeholder","Fragment","onChange","onFocus","val","_props$onFocus","onEnter","_props$onEnter","panel","inputProps","inputClass","classNames","className","_defineProperty","singleInputValue"],"mappings":"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"}