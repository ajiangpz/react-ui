{"version":3,"file":"useMultiple.js","sources":["../../../../components/select-input/hook/useMultiple.tsx"],"sourcesContent":["import React, { useRef, MouseEvent } from 'react';\r\nimport { isObject } from 'lodash-es';\r\nimport classNames from 'classnames';\r\nimport { TdSelectInputProps, SelectInputChangeContext, SelectInputKeys, SelectInputValue } from '../type';\r\nimport TagInput, { TagInputValue } from '../../tag-input';\r\nimport { SelectInputCommonProperties } from '../interface';\r\nimport useControlled from '../../hooks/useControlled';\r\nimport useConfig from '../../hooks/useConfig';\r\nimport { InputRef } from '../../input';\r\nimport { StyledProps } from '../../common';\r\n\r\nexport interface RenderSelectMultipleParams {\r\n    commonInputProps: SelectInputCommonProperties;\r\n    onInnerClear: (context: { e: MouseEvent<SVGElement> }) => void;\r\n    popupVisible: boolean;\r\n    allowInput: boolean;\r\n}\r\n\r\nconst DEFAULT_KEYS = {\r\n    label: 'label',\r\n    key: 'key',\r\n    children: 'children',\r\n};\r\n\r\nexport interface SelectInputProps extends TdSelectInputProps, StyledProps {\r\n    options?: any[]; // 参数穿透options, 给SelectInput/SelectInput 自定义选中项呈现的内容和多选状态下设置折叠项内容\r\n}\r\n\r\nexport default function useMultiple(props: SelectInputProps) {\r\n    const { value } = props;\r\n    const { classPrefix } = useConfig();\r\n    const tagInputRef = useRef<InputRef>(null);\r\n    const [tInputValue, setTInputValue] = useControlled(props, 'inputValue', props.onInputChange);\r\n    const iKeys: SelectInputKeys = { ...DEFAULT_KEYS, ...props.keys };\r\n\r\n    const getTags = () => {\r\n        if (!(value instanceof Array)) {\r\n            if (['', null, undefined].includes(value as any)) return [];\r\n            return isObject(value) ? [value[iKeys.label]] : [value];\r\n        }\r\n        return value.map((item: SelectInputValue) => (isObject(item) ? item[iKeys.label] : item));\r\n    };\r\n    const tags = getTags();\r\n    const tPlaceholder = !tags || !tags.length ? props.placeholder : '';\r\n\r\n    const onTagInputChange = (val: TagInputValue, context: SelectInputChangeContext) => {\r\n        // 避免触发浮层的显示或隐藏\r\n        if (context.trigger === 'tag-remove') {\r\n            context.e?.stopPropagation();\r\n        }\r\n        props.onTagChange?.(val, context);\r\n    };\r\n\r\n    const renderSelectMultiple = (p: RenderSelectMultipleParams) => (\r\n        <TagInput\r\n            ref={tagInputRef}\r\n            {...p.commonInputProps}\r\n            autoWidth={props.autoWidth}\r\n            readonly={props.readonly}\r\n            minCollapsedNum={props.minCollapsedNum}\r\n            collapsedItems={props.collapsedItems}\r\n            tag={props.tag}\r\n            valueDisplay={props.valueDisplay}\r\n            placeholder={tPlaceholder}\r\n            options={props.options}\r\n            value={tags}\r\n            inputValue={p.popupVisible && p.allowInput ? tInputValue : ''}\r\n            onChange={onTagInputChange}\r\n            onInputChange={(val, context) => {\r\n                // 筛选器统一特性：筛选器按下回车时不清空输入框\r\n                if (context?.trigger === 'enter' || context?.trigger === 'blur') return;\r\n                setTInputValue(val, { trigger: context.trigger, e: context.e });\r\n            }}\r\n            tagProps={props.tagProps}\r\n            onClear={p.onInnerClear}\r\n            // [Important Info]: SelectInput.blur is not equal to TagInput, example: click popup panel\r\n            onFocus={(val, context) => {\r\n                props.onFocus?.(props.value, { ...context, tagInputValue: val });\r\n            }}\r\n            onBlur={!props.panel ? props.onBlur : null}\r\n            {...props.tagInputProps}\r\n            inputProps={{\r\n                ...props.inputProps,\r\n                readonly: !props.allowInput || props.readonly,\r\n                inputClass: classNames(props.tagInputProps?.className, {\r\n                    [`${classPrefix}-input--focused`]: p.popupVisible,\r\n                    [`${classPrefix}-is-focused`]: p.popupVisible,\r\n                }),\r\n            }}\r\n        />\r\n    );\r\n\r\n    return {\r\n        tags,\r\n        tPlaceholder,\r\n        tagInputRef,\r\n        multipleInputValue: tInputValue,\r\n        renderSelectMultiple,\r\n    };\r\n}\r\n"],"names":["DEFAULT_KEYS","label","key","children","useMultiple","props","value","_useConfig","useConfig","classPrefix","tagInputRef","useRef","_useControlled","useControlled","onInputChange","_useControlled2","_slicedToArray","tInputValue","setTInputValue","iKeys","_objectSpread","keys","getTags","Array","undefined","includes","isObject","map","item","tags","tPlaceholder","length","placeholder","onTagInputChange","val","context","_props$onTagChange","trigger","_context$e","e","stopPropagation","onTagChange","call","renderSelectMultiple","p","_props$tagInputProps","React","createElement","TagInput","_extends","ref","commonInputProps","autoWidth","readonly","minCollapsedNum","collapsedItems","tag","valueDisplay","options","inputValue","popupVisible","allowInput","onChange","tagProps","onClear","onInnerClear","onFocus","_props$onFocus","tagInputValue","onBlur","panel","tagInputProps","inputProps","inputClass","classNames","className","_defineProperty","concat","multipleInputValue"],"mappings":"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"}