{"version":3,"file":"dep-DB-U1pIn.js","sources":["../../../../node_modules/.pnpm/@babel+runtime@7.26.10/node_modules/@babel/runtime/helpers/esm/createClass.js","../../../../node_modules/.pnpm/@babel+runtime@7.26.10/node_modules/@babel/runtime/helpers/esm/classCallCheck.js","../../../components/form/hooks/useForm.ts"],"sourcesContent":["import toPropertyKey from \"./toPropertyKey.js\";\nfunction _defineProperties(e, r) {\n  for (var t = 0; t < r.length; t++) {\n    var o = r[t];\n    o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, toPropertyKey(o.key), o);\n  }\n}\nfunction _createClass(e, r, t) {\n  return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, \"prototype\", {\n    writable: !1\n  }), e;\n}\nexport { _createClass as default };","function _classCallCheck(a, n) {\n  if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\");\n}\nexport { _classCallCheck as default };","import { useState, useRef } from 'react';\r\nimport type { NamePath } from '../type';\r\nimport type {\r\n  WatchCallBack,\r\n  InternalHooks,\r\n  InternalFormInstance,\r\n  Store,\r\n} from './interface';\r\n\r\nexport const HOOK_MARK = 'TD_FORM_INTERNAL_HOOKS';\r\n\r\nclass FormStore {\r\n  private prevStore: Store = {};\r\n\r\n  private store: Store = {};\r\n\r\n  private forceRootUpdate: () => void;\r\n\r\n  constructor(forceReRender) {\r\n    this.forceRootUpdate = forceReRender;\r\n  }\r\n\r\n  public taskQueue: any[] = [];\r\n\r\n  public flashQueue = () => {\r\n    this.taskQueue.forEach((task) => {\r\n      this[task.name].apply(this, [...task.args]);\r\n    });\r\n    this.taskQueue = [];\r\n  };\r\n\r\n  public getForm = (): InternalFormInstance => ({\r\n    submit: (...args) => {\r\n      this.taskQueue.push({ args, name: 'submit' });\r\n    },\r\n    reset: (...args) => {\r\n      this.taskQueue.push({ args, name: 'reset' });\r\n    },\r\n    validate: null,\r\n    validateOnly: null,\r\n    clearValidate: (...args) => {\r\n      this.taskQueue.push({ args, name: 'clearValidate' });\r\n    },\r\n    setFields: (...args) => {\r\n      this.taskQueue.push({ args, name: 'setFields' });\r\n    },\r\n    setFieldsValue: (...args) => {\r\n      this.taskQueue.push({ args, name: 'setFieldsValue' });\r\n    },\r\n    setValidateMessage: (...args) => {\r\n      this.taskQueue.push({ args, name: 'setValidateMessage' });\r\n    },\r\n    getValidateMessage: (...args) => {\r\n      this.taskQueue.push({ args, name: 'getValidateMessage' });\r\n    },\r\n    getFieldValue: null,\r\n    getFieldsValue: null,\r\n    _init: true,\r\n    store: this.store,\r\n    getInternalHooks: this.getInternalHooks,\r\n  });\r\n\r\n  private getInternalHooks = (key: string): InternalHooks | null => {\r\n    if (key === HOOK_MARK) {\r\n      return {\r\n        setForm: (formInstance) => {\r\n          Object.keys(formInstance).forEach((key) => {\r\n            this[key] = formInstance[key];\r\n          });\r\n        },\r\n        flashQueue: this.flashQueue,\r\n        notifyWatch: this.notifyWatch,\r\n        registerWatch: this.registerWatch,\r\n        getPrevStore: () => this.prevStore,\r\n        setPrevStore: (store: object) => {\r\n          this.prevStore = store;\r\n        },\r\n      };\r\n    }\r\n\r\n    console.warn(\r\n      'Form',\r\n      '`getInternalHooks` is internal usage. Should not call directly.',\r\n    );\r\n    return null;\r\n  };\r\n\r\n  private watchList: WatchCallBack[] = [];\r\n\r\n  private registerWatch: InternalHooks['registerWatch'] = (callback) => {\r\n    this.watchList.push(callback);\r\n\r\n    return () => {\r\n      this.watchList = this.watchList.filter((fn) => fn !== callback);\r\n    };\r\n  };\r\n\r\n  private notifyWatch = (namePath: NamePath = []) => {\r\n    // No need to cost perf when nothing need to watch\r\n    if (this.watchList.length) {\r\n      // @ts-ignore\r\n      const values = this.getFieldsValue?.([namePath]);\r\n\r\n      this.watchList.forEach((callback) => {\r\n        callback(values, namePath);\r\n      });\r\n    }\r\n  };\r\n}\r\n\r\nexport default function useForm(form?: InternalFormInstance) {\r\n  const formRef = useRef<InternalFormInstance>(Object.create({}));\r\n  const [, forceUpdate] = useState({});\r\n\r\n  // eslint-disable-next-line\r\n  if (!formRef.current._init) {\r\n    if (form) {\r\n      formRef.current = form;\r\n      // Reset store when reopening\r\n      formRef.current.store = {};\r\n    } else {\r\n      // Create a new FormStore if not provided\r\n      const forceReRender = () => {\r\n        forceUpdate({});\r\n      };\r\n\r\n      const formStore: FormStore = new FormStore(forceReRender);\r\n\r\n      formRef.current = formStore.getForm();\r\n    }\r\n  }\r\n\r\n  return [formRef.current];\r\n}\r\n"],"names":["HOOK_MARK","FormStore","_createClass","forceReRender","_this","_classCallCheck","_defineProperty","taskQueue","forEach","task","name","apply","_toConsumableArray","args","submit","_len","arguments","length","Array","_key","push","reset","_len2","_key2","validate","validateOnly","clearValidate","_len3","_key3","setFields","_len4","_key4","setFieldsValue","_len5","_key5","setValidateMessage","_len6","_key6","getValidateMessage","_len7","_key7","getFieldValue","getFieldsValue","_init","store","getInternalHooks","key","setForm","formInstance","Object","keys","flashQueue","notifyWatch","registerWatch","getPrevStore","prevStore","setPrevStore","console","warn","callback","watchList","filter","fn","namePath","undefined","_this$getFieldsValue","values","call","forceRootUpdate","useForm","form","formRef","useRef","create","_useState","useState","_useState2","_slicedToArray","forceUpdate","current","formStore","getForm"],"mappings":"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","x_google_ignoreList":[0,1]}