{"version":3,"file":"dep-Cpxla0Xq.js","sources":["../../../components/select/utils/helper.ts","../../../components/hooks/useVirtualScroll.ts","../../../components/select/hooks/usePanelVirtualScroll.ts","../../../components/select/PopupContent.tsx"],"sourcesContent":["import { ReactElement } from 'react';\r\nimport { isPlainObject, get } from 'lodash-es';\r\nimport OptionGroup from '../OptionGroup';\r\nimport Option from '../Option';\r\n\r\nimport {\r\n  SelectValue,\r\n  TdOptionProps,\r\n  SelectKeysType,\r\n  TdSelectProps,\r\n  SelectOption,\r\n} from '../type';\r\n\r\ntype SelectLabeledValue = Required<Omit<TdOptionProps, 'disabled'>>;\r\n\r\nexport function isSelectOptionGroup(\r\n  option: SelectOption,\r\n): option is any {\r\n  return !!option && 'group' in option && 'children' in option;\r\n}\r\n\r\nexport type ValueToOption = {\r\n  [value: string | number]: TdOptionProps;\r\n};\r\n\r\nfunction setValueToOptionFormOptionDom(\r\n  dom: ReactElement,\r\n  valueToOption: ValueToOption,\r\n  keys: SelectKeysType,\r\n) {\r\n  const { value, label, children } = dom.props;\r\n  // eslint-disable-next-line no-param-reassign\r\n  valueToOption[value] = {\r\n    ...dom.props,\r\n    [keys?.value || 'value']: value,\r\n    [keys?.label || 'label']: label || children || value,\r\n  };\r\n}\r\n\r\n// 获取 value => option，用于快速基于 value 找到对应的 option\r\nexport const getValueToOption = (\r\n  children: ReactElement,\r\n  options: SelectOption[],\r\n  keys: SelectKeysType,\r\n): ValueToOption => {\r\n  const valueToOption = {};\r\n\r\n  // options 优先级高于 children\r\n  if (Array.isArray(options)) {\r\n    options.forEach((option) => {\r\n      if (isSelectOptionGroup(option)) {\r\n        option.children?.forEach((child) => {\r\n          valueToOption[get(child, keys?.value || 'value')] = {\r\n            ...child,\r\n            value: get(child, keys?.value || 'value'),\r\n            label: get(child, keys?.label || 'label'),\r\n          };\r\n        });\r\n      } else {\r\n        valueToOption[get(option, keys?.value || 'value')]   = {\r\n          ...option as Object,\r\n          value: get(option, keys?.value || 'value'),\r\n          label: get(option, keys?.label || 'label'),\r\n        } as never;\r\n      }\r\n    });\r\n    return valueToOption;\r\n  }\r\n\r\n  if (isPlainObject(children)) {\r\n    if (children.type === Option) {\r\n      setValueToOptionFormOptionDom(children, valueToOption, keys);\r\n      return valueToOption;\r\n    }\r\n\r\n    if (children.type === OptionGroup) {\r\n      const groupChildren = children.props.children;\r\n\r\n      if (Array.isArray(groupChildren)) {\r\n        groupChildren.forEach((item) => {\r\n          setValueToOptionFormOptionDom(item, valueToOption, keys);\r\n        });\r\n        return valueToOption;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * children如果存在ReactElement和map函数混写的情况，会出现嵌套数组\r\n   */\r\n  if (Array.isArray(children)) {\r\n    const handlerElement = (item: ReactElement) => {\r\n      if (item.type === Option) {\r\n        setValueToOptionFormOptionDom(item, valueToOption, keys);\r\n      }\r\n\r\n      if (item.type === OptionGroup) {\r\n        const groupChildren = (item.props as SelectOption).children;\r\n        if (Array.isArray(groupChildren)) {\r\n          groupChildren.forEach((groupItem) => {\r\n            setValueToOptionFormOptionDom(groupItem, valueToOption, keys);\r\n          });\r\n        }\r\n      }\r\n\r\n      if (Array.isArray(item)) {\r\n        item.forEach((child) => {\r\n          handlerElement(child);\r\n        });\r\n      }\r\n    };\r\n    children.forEach((item: ReactElement) => handlerElement(item));\r\n  }\r\n\r\n  return valueToOption;\r\n};\r\n\r\n// 获取单选的 label\r\nexport const getLabel = (\r\n  children: ReactElement,\r\n  value: SelectValue<TdOptionProps>,\r\n  options: TdOptionProps[],\r\n  keys: SelectKeysType,\r\n) => {\r\n  let selectedLabel = '';\r\n  // 处理带 options 属性的情况\r\n  if (Array.isArray(options)) {\r\n    options.some((option) => {\r\n      if ([get(value, keys?.value || 'value'), value].includes(option.value)) {\r\n        selectedLabel = option.label;\r\n        return true;\r\n      }\r\n      return false;\r\n    });\r\n\r\n    return selectedLabel;\r\n  }\r\n\r\n  if (isPlainObject(children)) {\r\n    selectedLabel = children.props.label;\r\n\r\n    if (children.type === OptionGroup) {\r\n      const groupChildren = children.props.children;\r\n\r\n      if (Array.isArray(groupChildren)) {\r\n        groupChildren.some((item) => {\r\n          const selectedValue = isPlainObject(value)\r\n            ? get(value, 'value')\r\n            : value;\r\n          if (isPlainObject(item.props) && item.props.value === selectedValue) {\r\n            selectedLabel = item.props.label || item.props.children;\r\n            return true;\r\n          }\r\n          return false;\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  if (Array.isArray(children)) {\r\n    children.some((item: ReactElement) => {\r\n      // 处理分组\r\n      if (item.type === OptionGroup) {\r\n        const groupChildren = item.props.children;\r\n        if (Array.isArray(groupChildren)) {\r\n          const isSelected = groupChildren.some((item) => {\r\n            const selectedValue = isPlainObject(value)\r\n              ? get(value, 'value')\r\n              : value;\r\n            if (\r\n              isPlainObject(item.props) &&\r\n              item.props.value === selectedValue\r\n            ) {\r\n              selectedLabel = item.props.label || item.props.children;\r\n              return true;\r\n            }\r\n            return false;\r\n          });\r\n          return isSelected;\r\n        }\r\n      }\r\n      const selectedValue = isPlainObject(value) ? get(value, 'value') : value;\r\n      if (isPlainObject(item.props) && item.props.value === selectedValue) {\r\n        selectedLabel = item.props.label || item.props.children;\r\n        return true;\r\n      }\r\n      return false;\r\n    });\r\n  }\r\n\r\n  return selectedLabel;\r\n};\r\n\r\nexport const getMultipleTags = (\r\n  values: SelectValue[],\r\n  keys: SelectKeysType,\r\n) => {\r\n  const tags = values.map((item) => ({\r\n    label: get(item, keys?.label || 'label') || item.toString(),\r\n    value: get(item, keys?.value || 'value') || item,\r\n  }));\r\n  return tags;\r\n};\r\n\r\nexport const getSelectValueArr = (\r\n  values: SelectValue | SelectValue[],\r\n  activeValue: SelectValue,\r\n  selected?: boolean,\r\n  valueType?: TdSelectProps['valueType'],\r\n  keys?: SelectKeysType,\r\n  objVal?: SelectValue,\r\n) => {\r\n  // eslint-disable-next-line no-param-reassign\r\n  values = Array.isArray(values) ? values : [];\r\n\r\n  if (Array.isArray(values)) {\r\n    let currentValues = [...values];\r\n    const isValueObj = valueType === 'object';\r\n    if (selected) {\r\n      currentValues = currentValues.filter((item: SelectLabeledValue) => {\r\n        if (isValueObj) {\r\n          if (isPlainObject(activeValue)) {\r\n            return (\r\n              get(item, keys?.value || 'value') !==\r\n              get(activeValue, keys?.value || 'value')\r\n            );\r\n          }\r\n          return get(item, keys?.value || 'value') !== activeValue;\r\n        }\r\n        return item !== activeValue;\r\n      });\r\n    } else {\r\n      const item = isValueObj ? objVal : activeValue;\r\n\r\n      currentValues.push(item as SelectValue);\r\n    }\r\n    return currentValues;\r\n  }\r\n};\r\n\r\n// 计算onChange事件回调的selectedOptions参数\r\nexport const getSelectedOptions = (\r\n  value: SelectValue,\r\n  multiple: TdSelectProps['multiple'],\r\n  valueType: TdSelectProps['valueType'],\r\n  keys: SelectKeysType,\r\n  valueToOption: ValueToOption,\r\n  selectedValue?: SelectValue,\r\n) => {\r\n  const isObjectType = valueType === 'object';\r\n  // 当前所有选中的选项\r\n  let currentSelectedOptions = [];\r\n  // 当前选中的选项\r\n  let currentOption: SelectOption;\r\n  // 全选值\r\n  let allSelectedValue: Array<SelectValue>;\r\n  // 所有可选项\r\n  const tmpPropOptions = Object.values(valueToOption);\r\n  if (multiple) {\r\n    currentSelectedOptions = isObjectType\r\n      ? (value as Array<SelectValue>)\r\n      : tmpPropOptions?.filter?.((v) =>\r\n          (value as Array<string | number>).includes?.(\r\n            v[keys?.value || 'value'],\r\n          ),\r\n        );\r\n\r\n    allSelectedValue = isObjectType\r\n      ? currentSelectedOptions\r\n      : currentSelectedOptions?.map((v) => v[keys?.value || 'value']);\r\n\r\n    currentOption = isObjectType\r\n      ? (value as Array<SelectValue>).find(\r\n          (v) => v[keys?.value || 'value'] === selectedValue,\r\n        )\r\n      : currentSelectedOptions?.find(\r\n          (option) => option[keys?.value || 'value'] === selectedValue,\r\n        );\r\n  } else {\r\n    currentSelectedOptions = isObjectType\r\n      ? [value]\r\n      : tmpPropOptions?.filter?.((v) => value === v[keys?.value || 'value']) ||\r\n        [];\r\n    allSelectedValue = currentSelectedOptions;\r\n    currentOption = isObjectType\r\n      ? value\r\n      : currentSelectedOptions?.find(\r\n          (option) => option[keys?.value || 'value'] === selectedValue,\r\n        );\r\n  }\r\n\r\n  return { currentSelectedOptions, currentOption, allSelectedValue };\r\n};\r\n","/**\r\n * 通用虚拟滚动，可支持 Select/List/Table/TreeSelect/Cascader 等组件\r\n */\r\nimport { MutableRefObject, useEffect, useMemo, useRef, useState } from 'react';\r\nimport { isEqual } from 'lodash-es';\r\nimport type { ScrollToElementParams, TScroll } from '../common';\r\n\r\nexport type UseVirtualScrollParams = {\r\n  /** 列数据 */\r\n  data: { [key: string]: any }[];\r\n  scroll: TScroll & {\r\n    fixedRows?: Array<number>;\r\n  };\r\n};\r\n\r\nconst requestAnimationFrame =\r\n  (typeof window === 'undefined' ? false : window.requestAnimationFrame) ||\r\n  ((cb) => setTimeout(cb, 16.6));\r\n\r\nconst useVirtualScroll = (\r\n  container: MutableRefObject<HTMLElement>,\r\n  params: UseVirtualScrollParams,\r\n) => {\r\n  const { data, scroll } = params;\r\n  const dataRef = useRef(data);\r\n\r\n  /** 注意测试：数据长度为空；数据长度小于表格高度等情况。即期望只有数据量达到一定程度才允许开启虚拟滚动 */\r\n  const [visibleData, setVisibleData] = useState<any[]>([]);\r\n  // 滚动过程中表格顶部占位距离\r\n  const [translateY, setTranslateY] = useState(\r\n    () => (data?.length || 0) * (scroll?.rowHeight || 50),\r\n  );\r\n  // 滚动高度，用于显示滚动条\r\n  const [scrollHeight, setScrollHeight] = useState(0);\r\n  const trScrollTopHeightList = useRef<number[]>([]);\r\n  // 已经通过节点渲染计算出来的各自行高\r\n  const [trHeightList, setTrHeightList] = useState<number[]>([]);\r\n  const containerHeight = useRef(0);\r\n  const [startAndEndIndex, setStartAndEndIndex] = useState<[number, number]>(\r\n    () => [0, (scroll?.bufferSize || 10) * 3],\r\n  );\r\n\r\n  // 设置初始值\r\n  const tScroll = useMemo(() => {\r\n    if (!scroll) return {};\r\n    return {\r\n      bufferSize: scroll.bufferSize || 10,\r\n      isFixedRowHeight: scroll.isFixedRowHeight ?? false,\r\n      rowHeight: scroll.rowHeight || 47,\r\n      threshold: scroll.threshold || 100,\r\n      type: scroll.type,\r\n      fixedRows: scroll.fixedRows ?? [0, 0],\r\n    };\r\n  }, [scroll]);\r\n\r\n  // 当前场景是否满足开启虚拟滚动的条件\r\n  const isVirtualScroll = useMemo(\r\n    () => tScroll.type === 'virtual' && tScroll.threshold < data.length,\r\n    [tScroll, data],\r\n  );\r\n  const getTrScrollTopHeightList = (trHeightList: number[]) => {\r\n    const list: number[] = [];\r\n    // 大数据场景不建议使用 forEach 一类函数迭代\r\n    // 当前行滚动高度 = 上一行滚动高度 + 当前行高度\r\n    for (let i = 0, len = data.length; i < len; i++) {\r\n      list[i] = (list[i - 1] || 0) + (trHeightList[i] || tScroll.rowHeight);\r\n    }\r\n    return list;\r\n  };\r\n\r\n  const updateVisibleData = (\r\n    trScrollTopHeightList: number[],\r\n    scrollTop: number,\r\n  ) => {\r\n    let currentIndex = -1;\r\n    // 获取当前滚动到哪一个元素（大数据场景不建议使用 forEach 一类函数迭代）\r\n    for (let i = 0, len = trScrollTopHeightList.length; i < len; i++) {\r\n      if (trScrollTopHeightList[i] >= scrollTop) {\r\n        currentIndex = i;\r\n        break;\r\n      }\r\n    }\r\n    let lastIndex = trScrollTopHeightList.length;\r\n    const containerCurrentHeight =\r\n      containerHeight.current ||\r\n      container.current.getBoundingClientRect().height;\r\n    const scrollBottom = scrollTop + containerCurrentHeight;\r\n    // 获取当前视窗的最后一个元素（大数据场景不建议使用 forEach 一类函数迭代）\r\n    for (\r\n      let i = currentIndex, len = trScrollTopHeightList.length;\r\n      i < len;\r\n      i++\r\n    ) {\r\n      if (trScrollTopHeightList[i] >= scrollBottom) {\r\n        lastIndex = i;\r\n        break;\r\n      }\r\n    }\r\n    if (currentIndex < 0) return;\r\n    const startIndex = Math.max(currentIndex - tScroll.bufferSize, 0);\r\n    const endIndex = Math.min(\r\n      lastIndex + tScroll.bufferSize,\r\n      trScrollTopHeightList.length,\r\n    );\r\n\r\n    // 计算固定行情况\r\n    const { fixedRows } = tScroll;\r\n    const [fixedStart, fixedEnd] = fixedRows;\r\n    let fixedStartData = fixedStart ? data.slice(0, fixedStart) : [];\r\n    if (fixedStart && startIndex < fixedStart) {\r\n      fixedStartData = fixedStartData.slice(0, startIndex);\r\n    }\r\n    let fixedEndData = fixedEnd ? data.slice(data.length - fixedEnd) : [];\r\n    const bottomStartIndex = endIndex - data.length + 1 + (fixedEnd ?? 0);\r\n    if (fixedEnd && bottomStartIndex > 0) {\r\n      fixedEndData = fixedEndData.slice(bottomStartIndex);\r\n    }\r\n\r\n    if (\r\n      startAndEndIndex.join() !== [startIndex, endIndex].join() &&\r\n      startIndex >= 0\r\n    ) {\r\n      const tmpVisibleData = fixedStartData\r\n        .concat(data.slice(startIndex, endIndex))\r\n        .concat(fixedEndData);\r\n      setVisibleData(tmpVisibleData);\r\n      const lastScrollTop = trScrollTopHeightList[startIndex - 1];\r\n      const top = lastScrollTop > 0 ? lastScrollTop : 0;\r\n      const stickyHeight =\r\n        trScrollTopHeightList[Math.min(startIndex, fixedStart) - 1] || 0;\r\n      setTranslateY(top - stickyHeight);\r\n      setStartAndEndIndex([startIndex, endIndex]);\r\n    }\r\n  };\r\n\r\n  // 仅非固定高度场景需要\r\n  const handleRowMounted = (rowData: any) => {\r\n    if (\r\n      !isVirtualScroll ||\r\n      !rowData ||\r\n      tScroll.isFixedRowHeight ||\r\n      !container?.current\r\n    )\r\n      return;\r\n    const trHeight = rowData.ref.offsetHeight;\r\n    // eslint-disable-next-line\r\n    const rowIndex = rowData.data.__VIRTUAL_SCROLL_INDEX;\r\n    const newTrHeightList = trHeightList;\r\n    if (newTrHeightList[rowIndex] !== trHeight) {\r\n      newTrHeightList[rowIndex] = trHeight;\r\n      setTrHeightList(newTrHeightList);\r\n\r\n      const scrollTopHeightList = getTrScrollTopHeightList(newTrHeightList);\r\n      trScrollTopHeightList.current = scrollTopHeightList;\r\n\r\n      const lastIndex = scrollTopHeightList.length - 1;\r\n      setScrollHeight(scrollTopHeightList[lastIndex] - containerHeight.current);\r\n      updateVisibleData(scrollTopHeightList, container.current.scrollTop);\r\n    }\r\n  };\r\n\r\n  const handleScroll = () => {\r\n    if (!isVirtualScroll) return;\r\n    updateVisibleData(\r\n      trScrollTopHeightList.current,\r\n      container.current.scrollTop,\r\n    );\r\n  };\r\n\r\n  const addIndexToData = (data: any[]) => {\r\n    data.forEach((item, index) => {\r\n      Reflect.set(item, '__VIRTUAL_SCROLL_INDEX', index);\r\n    });\r\n  };\r\n\r\n  const updateScrollTop = ({\r\n    index,\r\n    top = 0,\r\n    behavior,\r\n  }: ScrollToElementParams) => {\r\n    const scrollTop = trScrollTopHeightList.current[index] - top;\r\n    container.current?.scrollTo({\r\n      top: scrollTop,\r\n      behavior: behavior || 'auto',\r\n    });\r\n  };\r\n\r\n  /**\r\n   * 滚动到指定元素（对外暴露的方法，谨慎修改）\r\n   */\r\n  const scrollToElement = (p: ScrollToElementParams) => {\r\n    updateScrollTop(p);\r\n    if (!tScroll.isFixedRowHeight) {\r\n      requestAnimationFrame(() => {\r\n        const duration = p.time ?? 60;\r\n        const timer = setTimeout(() => {\r\n          updateScrollTop(p);\r\n          clearTimeout(timer);\r\n        }, duration);\r\n      });\r\n    }\r\n  };\r\n\r\n  // 固定高度场景，可直接通过数据长度计算出最大滚动高度\r\n  useEffect(\r\n    () => {\r\n      if (!isVirtualScroll) {\r\n        trScrollTopHeightList.current = getTrScrollTopHeightList(trHeightList);\r\n        return;\r\n      }\r\n\r\n      // 给数据添加下标\r\n      addIndexToData(data);\r\n\r\n      const scrollTopHeightList = trScrollTopHeightList.current;\r\n      const dataChanged = !isEqual(dataRef.current, data);\r\n\r\n      if (scrollTopHeightList?.length === data?.length && !dataChanged) {\r\n        // 正常滚动时更新可见数据\r\n        const lastIndex = scrollTopHeightList.length - 1;\r\n        setScrollHeight(scrollTopHeightList[lastIndex]);\r\n\r\n        updateVisibleData(scrollTopHeightList, container.current.scrollTop);\r\n      } else {\r\n        /**\r\n        /* 进入这个分支的场景可能有：\r\n         * - 初始化\r\n         * - 从非虚拟滚动切换到虚拟滚动\r\n         * - 外部数据动态更新（长度变化、内容结构变化等）\r\n         */\r\n        dataRef.current = data;\r\n        setScrollHeight(data.length * tScroll.rowHeight);\r\n\r\n        // 如果之前存在滚动，基于原先数据计算位置\r\n        const currentScrollTop = container.current?.scrollTop || 0;\r\n        let currentIndex = Math.floor(currentScrollTop / tScroll.rowHeight);\r\n        const prevScrollTopHeightList = trScrollTopHeightList.current;\r\n        for (let i = 0; i < prevScrollTopHeightList?.length; i++) {\r\n          if (prevScrollTopHeightList[i] >= currentScrollTop) {\r\n            currentIndex = i;\r\n            break;\r\n          }\r\n        }\r\n\r\n        const startIndex = Math.max(currentIndex - tScroll.bufferSize, 0);\r\n        const visibleCount = Math.min(tScroll.bufferSize * 3, data.length);\r\n        const endIndex = Math.min(startIndex + visibleCount, data.length);\r\n        const tmpData = data.slice(startIndex, endIndex);\r\n\r\n        let translateY = startIndex * tScroll.rowHeight;\r\n\r\n        if (prevScrollTopHeightList?.length > 0 && startIndex > 0) {\r\n          const prevHeight =\r\n            prevScrollTopHeightList[\r\n              Math.min(startIndex - 1, prevScrollTopHeightList.length - 1)\r\n            ] || 0;\r\n          translateY = Math.max(0, prevHeight);\r\n        }\r\n\r\n        setVisibleData(tmpData);\r\n        setTranslateY(translateY);\r\n      }\r\n\r\n      const timer = setTimeout(() => {\r\n        if (container.current) {\r\n          const tmpContainerHeight =\r\n            container.current.getBoundingClientRect().height;\r\n          containerHeight.current = tmpContainerHeight;\r\n          const scrollTopHeightList = getTrScrollTopHeightList(trHeightList);\r\n          trScrollTopHeightList.current = scrollTopHeightList;\r\n          clearTimeout(timer);\r\n        }\r\n      }, 1);\r\n    },\r\n    // eslint-disable-next-line\r\n    [container, data, tScroll, isVirtualScroll, startAndEndIndex, trHeightList],\r\n  );\r\n\r\n  return {\r\n    visibleData,\r\n    translateY,\r\n    scrollHeight,\r\n    isVirtualScroll,\r\n    handleScroll,\r\n    handleRowMounted,\r\n    scrollToElement,\r\n  };\r\n};\r\n\r\nexport type VirtualScrollConfig = ReturnType<typeof useVirtualScroll>;\r\n\r\nexport default useVirtualScroll;\r\n","import {\r\n  useEffect,\r\n  useMemo,\r\n  MutableRefObject,\r\n  useCallback,\r\n  CSSProperties,\r\n} from 'react';\r\nimport useVirtualScroll from '../../hooks/useVirtualScroll';\r\nimport { TdSelectProps } from '../type';\r\nimport { TScroll, SizeEnum } from '../../common';\r\n\r\ninterface PanelVirtualScroll {\r\n  scroll?: TdSelectProps['scroll'];\r\n  popupContentRef: MutableRefObject<HTMLDivElement>;\r\n  options: TdSelectProps['options'];\r\n  size: SizeEnum;\r\n}\r\n\r\nconst usePanelVirtualScroll = ({\r\n  popupContentRef,\r\n  scroll,\r\n  options,\r\n  size,\r\n}: PanelVirtualScroll) => {\r\n  const scrollThreshold = scroll?.threshold || 100;\r\n  const scrollType = scroll?.type;\r\n\r\n  const isVirtual = useMemo<boolean>(\r\n    () => scrollType === 'virtual' && options?.length > scrollThreshold,\r\n    [scrollType, scrollThreshold, options],\r\n  );\r\n\r\n  const scrollParams = useMemo<TScroll>(() => {\r\n    const heightMap = {\r\n      small: 20,\r\n      medium: 28,\r\n      large: 36,\r\n    };\r\n    const rowHeight = heightMap[size] || 28;\r\n    return {\r\n      type: 'virtual',\r\n      isFixedRowHeight: scroll?.isFixedRowHeight || false,\r\n      rowHeight: scroll?.rowHeight || rowHeight,\r\n      bufferSize: scroll?.bufferSize || 20,\r\n      threshold: scrollThreshold,\r\n    };\r\n  }, [scroll, scrollThreshold, size]);\r\n\r\n  const {\r\n    visibleData = null,\r\n    handleScroll: handleVirtualScroll = null,\r\n    scrollHeight = null,\r\n    translateY = null,\r\n    handleRowMounted = null,\r\n  } = useVirtualScroll(popupContentRef, {\r\n    data: options || [],\r\n    scroll: scrollParams,\r\n  });\r\n\r\n  let lastScrollY = -1;\r\n\r\n  const onInnerVirtualScroll = useCallback((e: WheelEvent) => {\r\n    if (!isVirtual) {\r\n      return;\r\n    }\r\n    const target = e.target as HTMLElement;\r\n    const top = target.scrollTop;\r\n    // 排除横向滚动触发的纵向虚拟滚动计算\r\n    if (Math.abs(lastScrollY - top) > 5) {\r\n      handleVirtualScroll();\r\n      // eslint-disable-next-line react-hooks/exhaustive-deps\r\n      lastScrollY = top;\r\n    } else {\r\n      lastScrollY = -1;\r\n    }\r\n  }, []);\r\n\r\n  // 监听popup滚动 处理虚拟滚动时的virtualData变化\r\n  useEffect(() => {\r\n    const popupContentDom = popupContentRef?.current;\r\n    if (isVirtual) {\r\n      popupContentDom?.addEventListener?.('scroll', onInnerVirtualScroll);\r\n    }\r\n    return () => {\r\n      // 卸载时取消监听\r\n      if (isVirtual) {\r\n        popupContentDom?.removeEventListener?.('scroll', onInnerVirtualScroll);\r\n      }\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [isVirtual, onInnerVirtualScroll, popupContentRef.current]);\r\n\r\n  const cursorStyle = {\r\n    position: 'absolute',\r\n    width: '1px',\r\n    height: '1px',\r\n    transition: 'transform 0.2s',\r\n    transform: `translate(0, ${scrollHeight}px)`,\r\n    MsTransform: `translate(0, ${scrollHeight}px)`,\r\n    MozTransform: `translate(0, ${scrollHeight}px)`,\r\n    WebkitTransform: `translate(0, ${scrollHeight}px)`,\r\n  } as CSSProperties;\r\n\r\n  const panelStyle = {\r\n    transform: `translate(0, ${translateY}px)`,\r\n    MsTransform: `translate(0, ${translateY}px)`,\r\n    MozTransform: `translate(0, ${translateY}px)`,\r\n    WebkitTransform: `translate(0, ${translateY}px)`,\r\n  } as CSSProperties;\r\n\r\n  return {\r\n    scrollHeight,\r\n    translateY,\r\n    visibleData,\r\n    handleRowMounted,\r\n    isVirtual,\r\n    cursorStyle,\r\n    panelStyle,\r\n  };\r\n};\r\n\r\nexport default usePanelVirtualScroll;\r\n","import React, {\r\n  Children,\r\n  isValidElement,\r\n  cloneElement,\r\n  useRef,\r\n  CSSProperties,\r\n  useMemo,\r\n} from 'react';\r\nimport classNames from 'classnames';\r\nimport { isEqual } from 'lodash-es';\r\nimport { getSelectValueArr } from './utils/helper';\r\nimport {\r\n  TdSelectProps,\r\n  SelectValue,\r\n  TdOptionProps,\r\n  SelectValueChangeTrigger,\r\n  SelectOption,\r\n  SelectOptionGroup,\r\n} from './type';\r\nimport useConfig from '../hooks/useConfig';\r\nimport usePanelVirtualScroll from './hooks/usePanelVirtualScroll';\r\nimport Option, { SelectOptionProps } from './Option';\r\nimport OptionGroup from './OptionGroup';\r\n\r\ninterface SelectPopupProps\r\n  extends Pick<\r\n    TdSelectProps,\r\n    | 'value'\r\n    | 'size'\r\n    | 'multiple'\r\n    | 'empty'\r\n    | 'options'\r\n    | 'max'\r\n    | 'loadingText'\r\n    | 'loading'\r\n    | 'valueType'\r\n    | 'keys'\r\n    | 'panelTopContent'\r\n    | 'panelBottomContent'\r\n    | 'scroll'\r\n  > {\r\n  onChange?: (\r\n    value: SelectValue,\r\n    context?: {\r\n      label?: string | number;\r\n      value?: SelectValue;\r\n      restData?: Record<string, any>;\r\n      e: React.MouseEvent<HTMLLIElement>;\r\n      trigger: SelectValueChangeTrigger;\r\n    },\r\n  ) => void;\r\n  /**\r\n   * 是否展示popup\r\n   */\r\n  showPopup: boolean;\r\n  /**\r\n   * 控制popup展示的函数\r\n   */\r\n  setShowPopup: (show: boolean) => void;\r\n  children?: React.ReactNode;\r\n  onCheckAllChange?: (\r\n    checkAll: boolean,\r\n    e: React.MouseEvent<HTMLLIElement>,\r\n  ) => void;\r\n  getPopupInstance?: () => HTMLDivElement;\r\n}\r\n\r\nconst PopupContent = React.forwardRef<HTMLDivElement, SelectPopupProps>(\r\n  (props, ref) => {\r\n    const {\r\n      value,\r\n      size,\r\n      max,\r\n      multiple,\r\n      showPopup,\r\n      setShowPopup,\r\n      empty,\r\n      loadingText,\r\n      loading,\r\n      valueType,\r\n      children,\r\n      keys,\r\n      panelTopContent,\r\n      panelBottomContent,\r\n      onChange,\r\n      onCheckAllChange,\r\n      getPopupInstance,\r\n      options: propsOptions,\r\n      scroll: propsScroll,\r\n    } = props;\r\n\r\n    // 国际化文本初始化\r\n    // const [local, t] = useLocaleReceiver('select');\r\n    // const emptyText = t(local.empty);\r\n    const popupContentRef = useRef<HTMLDivElement>(null);\r\n\r\n    popupContentRef.current = getPopupInstance();\r\n\r\n    const {\r\n      visibleData,\r\n      handleRowMounted,\r\n      isVirtual,\r\n      panelStyle,\r\n      cursorStyle,\r\n    } = usePanelVirtualScroll({\r\n      popupContentRef,\r\n      scroll: propsScroll,\r\n      options: propsOptions,\r\n      size,\r\n    });\r\n\r\n    // 全部可选选项\r\n    const selectableOptions = useMemo(() => {\r\n      const uniqueOptions = {};\r\n      propsOptions?.forEach((option: SelectOption) => {\r\n        if ((option as SelectOptionGroup).group) {\r\n          (option as SelectOptionGroup).children.forEach((item) => {\r\n            if (!item.disabled && !item.checkAll) {\r\n              uniqueOptions[item.value] = item;\r\n            }\r\n          });\r\n        } else if (\r\n          !(option as TdOptionProps).disabled &&\r\n          !(option as TdOptionProps).checkAll\r\n        ) {\r\n          uniqueOptions[(option as TdOptionProps).value] = option;\r\n        }\r\n      });\r\n      return Object.values(uniqueOptions);\r\n    }, [propsOptions]);\r\n\r\n    const { classPrefix } = useConfig();\r\n    if (!children && !propsOptions) {\r\n      return null;\r\n    }\r\n\r\n    const onSelect: SelectOptionProps['onSelect'] = (\r\n      selectedValue,\r\n      { label, selected, event, restData },\r\n    ) => {\r\n      const isValObj = valueType === 'object';\r\n      let objVal = {};\r\n      if (isValObj) {\r\n        objVal = { ...restData };\r\n        if (!keys?.label) {\r\n          Object.assign(objVal, { label });\r\n        }\r\n        if (!keys?.value) {\r\n          Object.assign(objVal, { value: selectedValue });\r\n        }\r\n      }\r\n\r\n      if (!Object.keys(objVal).length) {\r\n        Object.assign(objVal, {\r\n          [keys?.label || 'label']: label,\r\n          [keys?.value || 'value']: selectedValue,\r\n        });\r\n      }\r\n\r\n      if (multiple) {\r\n        // calc multiple select values\r\n        const values = getSelectValueArr(\r\n          value,\r\n          selectedValue,\r\n          selected,\r\n          valueType,\r\n          keys,\r\n          objVal,\r\n        );\r\n        onChange(values, {\r\n          label,\r\n          value: selectedValue,\r\n          e: event,\r\n          trigger: selected ? 'uncheck' : 'check',\r\n        });\r\n      } else {\r\n        // calc single select value\r\n        const selectVal = valueType === 'object' ? objVal : selectedValue;\r\n\r\n        if (!isEqual(value, selectVal)) {\r\n          onChange(selectVal, {\r\n            label,\r\n            value: selectVal,\r\n            e: event,\r\n            trigger: 'check',\r\n          });\r\n        }\r\n        setShowPopup(!showPopup);\r\n      }\r\n    };\r\n\r\n    const childrenWithProps = Children.map(children, (child) => {\r\n      if (isValidElement(child)) {\r\n        const addedProps = {\r\n          size,\r\n          max,\r\n          multiple,\r\n          selectedValue: value,\r\n          onSelect,\r\n        };\r\n        return cloneElement(child, { ...addedProps });\r\n      }\r\n      return child;\r\n    });\r\n\r\n    // 渲染 options\r\n    const renderOptions = (options: SelectOption[]) => {\r\n      if (options) {\r\n        // 通过 options API配置的\r\n        return (\r\n          <ul className={`${classPrefix}-select__list`}>\r\n            {options.map((item, index) => {\r\n              const { group, divider, ...rest } = item as SelectOptionGroup;\r\n              if (group) {\r\n                return (\r\n                  <OptionGroup label={group} divider={divider} key={index}>\r\n                    {renderOptions(rest.children)}\r\n                  </OptionGroup>\r\n                );\r\n              }\r\n\r\n              const {\r\n                value: optionValue,\r\n                label,\r\n                disabled,\r\n                content,\r\n                children,\r\n                ...restData\r\n              } = item as TdOptionProps;\r\n              return (\r\n                <Option\r\n                  key={index}\r\n                  max={max}\r\n                  label={label}\r\n                  value={optionValue}\r\n                  onSelect={onSelect}\r\n                  selectedValue={value}\r\n                  optionLength={selectableOptions.length}\r\n                  multiple={multiple}\r\n                  size={size}\r\n                  disabled={disabled}\r\n                  restData={restData}\r\n                  keys={keys}\r\n                  content={content}\r\n                  onCheckAllChange={onCheckAllChange}\r\n                  onRowMounted={handleRowMounted}\r\n                  {...(isVirtual\r\n                    ? {\r\n                      isVirtual,\r\n                      bufferSize: propsScroll?.bufferSize,\r\n                      scrollType: propsScroll?.type,\r\n                    }\r\n                    : {})}\r\n                  {...restData}\r\n                >\r\n                  {children}\r\n                </Option>\r\n              );\r\n            })}\r\n          </ul>\r\n        );\r\n      }\r\n      return (\r\n        <ul className={`${classPrefix}-select__list`}>{childrenWithProps}</ul>\r\n      );\r\n    };\r\n\r\n    const isEmpty =\r\n      (Array.isArray(childrenWithProps) && !childrenWithProps.length) ||\r\n      (propsOptions && propsOptions.length === 0);\r\n\r\n    const renderPanel = (\r\n      renderedOptions: SelectOption[],\r\n      extraStyle?: CSSProperties,\r\n    ) => (\r\n      <div\r\n        ref={ref}\r\n        className={classNames(`${classPrefix}-select__dropdown-inner`, {\r\n          [`${classPrefix}-select__dropdown-inner--size-s`]: size === 'small',\r\n          [`${classPrefix}-select__dropdown-inner--size-l`]: size === 'large',\r\n          [`${classPrefix}-select__dropdown-inner--size-m`]: size === 'medium',\r\n        })}\r\n        style={extraStyle}\r\n      >\r\n        {loading && (\r\n          <div className={`${classPrefix}-select__loading-tips`}>\r\n            {loadingText}\r\n          </div>\r\n        )}\r\n        {!loading && isEmpty && (\r\n          <div className={`${classPrefix}-select__empty`}>{empty}</div>\r\n        )}\r\n        {!loading && !isEmpty && renderOptions(renderedOptions)}\r\n      </div>\r\n    );\r\n    if (isVirtual) {\r\n      return (\r\n        <>\r\n          {panelTopContent}\r\n          <div>\r\n            <div style={cursorStyle}></div>\r\n            {renderPanel(visibleData, panelStyle)}\r\n          </div>\r\n          {panelBottomContent}\r\n        </>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <>\r\n        {panelTopContent}\r\n        {renderPanel(propsOptions)}\r\n        {panelBottomContent}\r\n      </>\r\n    );\r\n  },\r\n);\r\n\r\nexport default PopupContent;\r\n"],"names":["isSelectOptionGroup","option","setValueToOptionFormOptionDom","dom","valueToOption","keys","_dom$props","props","value","label","children","_objectSpread","_defineProperty","getValueToOption","options","Array","isArray","forEach","_option$children","child","get","isPlainObject","type","Option","OptionGroup","groupChildren","item","handlerElement","groupItem","getLabel","selectedLabel","some","includes","selectedValue","isSelected","getMultipleTags","values","tags","map","toString","getSelectValueArr","activeValue","selected","valueType","objVal","currentValues","_toConsumableArray","isValueObj","filter","push","getSelectedOptions","multiple","isObjectType","currentSelectedOptions","currentOption","allSelectedValue","tmpPropOptions","Object","_tmpPropOptions$filte","_currentSelectedOptio","_currentSelectedOptio2","call","v","_includes","_ref","find","_tmpPropOptions$filte2","_currentSelectedOptio3","requestAnimationFrame","window","cb","setTimeout","useVirtualScroll","container","params","data","scroll","dataRef","useRef","_useState","useState","_useState2","_slicedToArray","visibleData","setVisibleData","_useState3","length","rowHeight","_useState4","translateY","setTranslateY","_useState5","_useState6","scrollHeight","setScrollHeight","trScrollTopHeightList","_useState7","_useState8","trHeightList","setTrHeightList","containerHeight","_useState9","bufferSize","_useState0","startAndEndIndex","setStartAndEndIndex","tScroll","useMemo","_scroll$isFixedRowHei","_scroll$fixedRows","isFixedRowHeight","threshold","fixedRows","isVirtualScroll","getTrScrollTopHeightList","list","i","len","updateVisibleData","scrollTop","currentIndex","lastIndex","containerCurrentHeight","current","getBoundingClientRect","height","scrollBottom","startIndex","Math","max","endIndex","min","_fixedRows","fixedStart","fixedEnd","fixedStartData","slice","fixedEndData","bottomStartIndex","join","tmpVisibleData","concat","lastScrollTop","top","stickyHeight","handleRowMounted","rowData","trHeight","ref","offsetHeight","rowIndex","__VIRTUAL_SCROLL_INDEX","newTrHeightList","scrollTopHeightList","handleScroll","addIndexToData","index","Reflect","set","updateScrollTop","_container$current","_ref$top","behavior","scrollTo","scrollToElement","p","_p$time","duration","time","timer","clearTimeout","useEffect","dataChanged","isEqual","_container$current2","currentScrollTop","floor","prevScrollTopHeightList","visibleCount","tmpData","prevHeight","tmpContainerHeight","usePanelVirtualScroll","popupContentRef","size","scrollThreshold","scrollType","isVirtual","scrollParams","heightMap","small","medium","large","_useVirtualScroll","_useVirtualScroll$vis","_useVirtualScroll$han","handleVirtualScroll","_useVirtualScroll$scr","_useVirtualScroll$tra","_useVirtualScroll$han2","lastScrollY","onInnerVirtualScroll","useCallback","e","target","abs","popupContentDom","_popupContentDom$addE","addEventListener","_popupContentDom$remo","removeEventListener","cursorStyle","position","width","transition","transform","MsTransform","MozTransform","WebkitTransform","panelStyle","PopupContent","React","forwardRef","showPopup","setShowPopup","empty","loadingText","loading","panelTopContent","panelBottomContent","onChange","onCheckAllChange","getPopupInstance","propsOptions","propsScroll","_usePanelVirtualScrol","selectableOptions","uniqueOptions","group","disabled","checkAll","_useConfig","useConfig","classPrefix","onSelect","event","restData","isValObj","assign","trigger","selectVal","childrenWithProps","Children","isValidElement","addedProps","cloneElement","renderOptions","createElement","className","_ref2","divider","rest","_objectWithoutProperties","_excluded","key","_ref3","optionValue","content","_excluded2","_extends","optionLength","onRowMounted","isEmpty","renderPanel","renderedOptions","extraStyle","classNames","style","Fragment"],"mappings":"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"}