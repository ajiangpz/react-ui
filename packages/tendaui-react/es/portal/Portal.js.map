{"version":3,"file":"Portal.js","sources":["../../../components/portal/Portal.tsx"],"sourcesContent":["import React, { forwardRef, useMemo, useImperativeHandle } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { canUseDocument } from '../utils/dom';\r\nimport { AttachNode, AttachNodeReturnValue } from '../common';\r\nimport useIsomorphicLayoutEffect from '../hooks/useLayoutEffect';\r\n\r\nexport interface PortalProps {\r\n  /**\r\n   * 指定挂载的 HTML 节点, false 为挂载在 body\r\n   */\r\n  attach?: React.ReactElement | AttachNode | boolean;\r\n  /**\r\n   * 触发元素\r\n   */\r\n  triggerNode?: HTMLElement;\r\n  children: React.ReactNode;\r\n}\r\n// 获取挂载的 HTML 节点\r\n\r\nexport function getAttach(\r\n  attach: PortalProps['attach'],\r\n  triggerNode?: HTMLElement,\r\n): AttachNodeReturnValue {\r\n  if (!canUseDocument) return null;\r\n\r\n  let el: AttachNodeReturnValue = null;\r\n  if (typeof attach === 'string') {\r\n    el = document.querySelector(attach);\r\n  }\r\n  if (typeof attach === 'function') {\r\n    el = attach(triggerNode);\r\n  }\r\n  if (typeof attach === 'object' && attach instanceof window.HTMLElement) {\r\n    el = attach;\r\n  }\r\n\r\n  // fix el in iframe\r\n  if (el && el.nodeType === 1) return el;\r\n\r\n  return document.body;\r\n}\r\n\r\nconst Portal = forwardRef((props: PortalProps, ref) => {\r\n  const { attach, children, triggerNode } = props;\r\n  const container = useMemo(() => {\r\n    const div = document.createElement('div');\r\n    div.className = 'portal-container bg-primary';\r\n    return div;\r\n  }, []);\r\n  // 兼容 SSR 环境\r\n  useIsomorphicLayoutEffect(() => {\r\n    const parentElement = getAttach(attach, triggerNode);\r\n    parentElement?.appendChild?.(container);\r\n    // Clean up the container when the component unmounts\r\n    return () => {\r\n      parentElement?.removeChild?.(container);\r\n    };\r\n  }, [container, attach, triggerNode]);\r\n  // 自定义暴露给父组件的ref是container\r\n  useImperativeHandle(ref, () => container);\r\n\r\n  return canUseDocument ? createPortal(children, container) : null;\r\n});\r\n\r\nPortal.displayName = 'Portal';\r\nexport default Portal;\r\n"],"names":["getAttach","attach","triggerNode","canUseDocument","el","document","querySelector","_typeof","window","HTMLElement","nodeType","body","Portal","forwardRef","props","ref","children","container","useMemo","div","createElement","className","useIsomorphicLayoutEffect","_parentElement$append","parentElement","appendChild","call","_parentElement$remove","removeChild","useImperativeHandle","createPortal","displayName"],"mappings":";;;;;;AAiBA;;AAEO,SAASA,SAASA,CACvBC,MAA6B,EAC7BC,WAAyB,EACF;AACvB,EAAA,IAAI,CAACC,cAAc,EAAE,OAAO,IAAI;EAEhC,IAAIC,EAAyB,GAAG,IAAI;AACpC,EAAA,IAAI,OAAOH,MAAM,KAAK,QAAQ,EAAE;AAC9BG,IAAAA,EAAE,GAAGC,QAAQ,CAACC,aAAa,CAACL,MAAM,CAAC;AACrC,EAAA;AACA,EAAA,IAAI,OAAOA,MAAM,KAAK,UAAU,EAAE;AAChCG,IAAAA,EAAE,GAAGH,MAAM,CAACC,WAAW,CAAC;AAC1B,EAAA;EACA,IAAIK,OAAA,CAAON,MAAM,CAAA,KAAK,QAAQ,IAAIA,MAAM,YAAYO,MAAM,CAACC,WAAW,EAAE;AACtEL,IAAAA,EAAE,GAAGH,MAAM;AACb,EAAA;;AAEA;EACA,IAAIG,EAAE,IAAIA,EAAE,CAACM,QAAQ,KAAK,CAAC,EAAE,OAAON,EAAE;EAEtC,OAAOC,QAAQ,CAACM,IAAI;AACtB;AAEA,IAAMC,MAAM,gBAAGC,UAAU,CAAC,UAACC,KAAkB,EAAEC,GAAG,EAAK;AACrD,EAAA,IAAQd,MAAM,GAA4Ba,KAAK,CAAvCb,MAAM;IAAEe,QAAQ,GAAkBF,KAAK,CAA/BE,QAAQ;IAAEd,WAAW,GAAKY,KAAK,CAArBZ,WAAW;AACrC,EAAA,IAAMe,SAAS,GAAGC,OAAO,CAAC,YAAM;AAC9B,IAAA,IAAMC,GAAG,GAAGd,QAAQ,CAACe,aAAa,CAAC,KAAK,CAAC;IACzCD,GAAG,CAACE,SAAS,GAAG,6BAA6B;AAC7C,IAAA,OAAOF,GAAG;EACZ,CAAC,EAAE,EAAE,CAAC;AACN;AACAG,EAAAA,yBAAyB,CAAC,YAAM;AAAA,IAAA,IAAAC,qBAAA;AAC9B,IAAA,IAAMC,aAAa,GAAGxB,SAAS,CAACC,MAAM,EAAEC,WAAW,CAAC;AACpDsB,IAAAA,aAAa,aAAbA,aAAa,KAAA,KAAA,CAAA,IAAA,CAAAD,qBAAA,GAAbC,aAAa,CAAEC,WAAW,MAAA,IAAA,IAAAF,qBAAA,KAAA,KAAA,CAAA,IAA1BA,qBAAA,CAAAG,IAAA,CAAAF,aAAa,EAAgBP,SAAS,CAAC;AACvC;AACA,IAAA,OAAO,YAAM;AAAA,MAAA,IAAAU,qBAAA;AACXH,MAAAA,aAAa,aAAbA,aAAa,KAAA,KAAA,CAAA,IAAA,CAAAG,qBAAA,GAAbH,aAAa,CAAEI,WAAW,MAAA,IAAA,IAAAD,qBAAA,KAAA,KAAA,CAAA,IAA1BA,qBAAA,CAAAD,IAAA,CAAAF,aAAa,EAAgBP,SAAS,CAAC;IACzC,CAAC;EACH,CAAC,EAAE,CAACA,SAAS,EAAEhB,MAAM,EAAEC,WAAW,CAAC,CAAC;AACpC;EACA2B,mBAAmB,CAACd,GAAG,EAAE,YAAA;AAAA,IAAA,OAAME,SAAS;EAAA,CAAA,CAAC;EAEzC,OAAOd,cAAc,gBAAG2B,YAAY,CAACd,QAAQ,EAAEC,SAAS,CAAC,GAAG,IAAI;AAClE,CAAC;AAEDL,MAAM,CAACmB,WAAW,GAAG,QAAQ;;;;"}