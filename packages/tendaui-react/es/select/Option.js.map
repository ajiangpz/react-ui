{"version":3,"file":"Option.js","sources":["../../../components/select/Option.tsx"],"sourcesContent":["import React, { useEffect, useMemo } from 'react';\r\nimport classNames from 'classnames';\r\nimport { isNumber, isString, get } from 'lodash-es';\r\n\r\nimport useConfig from '../hooks/useConfig';\r\nimport useDomRefCallback from '../hooks/useDomRefCallback';\r\n\r\nimport { StyledProps } from '../common';\r\nimport {\r\n  SelectValue,\r\n  TdOptionProps,\r\n  TdSelectProps,\r\n  SelectKeysType,\r\n  SelectOption,\r\n} from './type';\r\n\r\nexport interface SelectOptionProps\r\n  extends StyledProps,\r\n  TdOptionProps,\r\n  Pick<TdSelectProps, 'size' | 'multiple' | 'max'> {\r\n  selectedValue?: SelectValue;\r\n  children?: React.ReactNode;\r\n  onSelect?: (\r\n    value: string | number,\r\n    context: {\r\n      label?: string;\r\n      selected?: boolean;\r\n      event: React.MouseEvent<HTMLLIElement>;\r\n      restData?: Record<string, any>;\r\n    },\r\n  ) => void;\r\n  onCheckAllChange?: (\r\n    checkAll: boolean,\r\n    e: React.MouseEvent<HTMLLIElement>,\r\n  ) => void;\r\n  restData?: Record<string, any>;\r\n  keys?: SelectKeysType;\r\n  optionLength?: number;\r\n  isVirtual?: boolean;\r\n  onRowMounted?: (rowData: { ref: HTMLElement; data: SelectOption }) => void;\r\n}\r\n\r\nconst componentType = 'select';\r\n\r\nconst Option: React.FC<SelectOptionProps> = (props) => {\r\n  const {\r\n    disabled: propDisabled,\r\n    label: propLabel,\r\n    title: propTitle,\r\n    selectedValue,\r\n    checkAll,\r\n    multiple,\r\n    size,\r\n    max,\r\n    keys,\r\n    value,\r\n    onSelect,\r\n    children,\r\n    content,\r\n    restData,\r\n    style,\r\n    className,\r\n    isVirtual,\r\n  } = props;\r\n  let selected: boolean;\r\n  let indeterminate: boolean;\r\n  const label = propLabel || value;\r\n  const disabled =\r\n    propDisabled ||\r\n    (multiple &&\r\n      Array.isArray(selectedValue) &&\r\n      max &&\r\n      selectedValue.length >= max);\r\n\r\n  const titleContent = useMemo(() => {\r\n    // 外部设置 props，说明希望受控\r\n    const controlledTitle = Reflect.has(props, 'title');\r\n    if (controlledTitle) return propTitle;\r\n    if (typeof label === 'string') return label;\r\n    return null;\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [propTitle, label]);\r\n  const { classPrefix } = useConfig();\r\n  // 使用斜八角动画\r\n  const [optionRef, setRefCurrent] = useDomRefCallback();\r\n\r\n  useEffect(() => {\r\n    if (isVirtual && optionRef) {\r\n      props.onRowMounted?.({\r\n        ref: optionRef,\r\n        data: props,\r\n      });\r\n    }\r\n    // eslint-disable-next-line\r\n  }, [isVirtual, optionRef]);\r\n\r\n  // 处理单选场景\r\n  if (!multiple) {\r\n    selected =\r\n      isNumber(selectedValue) || isString(selectedValue)\r\n        ? value === selectedValue\r\n        : value === get(selectedValue, keys?.value || 'value');\r\n  }\r\n\r\n  // 处理多选场景\r\n  if (multiple && Array.isArray(selectedValue)) {\r\n    selected = selectedValue.some((item) => {\r\n      if (isNumber(item) || isString(item)) {\r\n        // 如果非 object 类型\r\n        return item === value;\r\n      }\r\n      return get(item, keys?.value || 'value') === value;\r\n    });\r\n    if (props.checkAll) {\r\n      selected = selectedValue.length === props.optionLength;\r\n      indeterminate = selectedValue.length > 0 && !selected;\r\n    }\r\n  }\r\n\r\n  const handleSelect = (event: React.MouseEvent<HTMLLIElement>) => {\r\n    if (!disabled && !checkAll) {\r\n      if (value)\r\n        onSelect?.(value, { label: String(label), selected, event, restData });\r\n    }\r\n    if (checkAll) {\r\n      props.onCheckAllChange?.(selected, event);\r\n    }\r\n  };\r\n\r\n  const renderItem = (children: React.ReactNode) => {\r\n    if (multiple) {\r\n      return (\r\n        <label\r\n          className={classNames(`${classPrefix}-checkbox`, {\r\n            [`${classPrefix}-is-indeterminate`]: indeterminate,\r\n            [`${classPrefix}-is-disabled`]: disabled,\r\n            [`${classPrefix}-is-checked`]: selected,\r\n          })}\r\n          title={titleContent}\r\n        >\r\n          <input\r\n            type=\"checkbox\"\r\n            className={classNames(`${classPrefix}-checkbox__former`)}\r\n            value=\"\"\r\n            disabled={disabled && !selected}\r\n            onClick={(e) => {\r\n              e.stopPropagation();\r\n              e.nativeEvent.stopImmediatePropagation();\r\n            }}\r\n          />\r\n          <span className={classNames(`${classPrefix}-checkbox__input`)}></span>\r\n          <span className={classNames(`${classPrefix}-checkbox__label`)}>\r\n            {children || content || label}\r\n          </span>\r\n        </label>\r\n      );\r\n    }\r\n    return <span title={titleContent}>{children || content || label}</span>;\r\n  };\r\n\r\n  return (\r\n    <li\r\n      className={classNames(\r\n        className,\r\n        `${classPrefix}-${componentType}-option`,\r\n        {\r\n          [`${classPrefix}-is-disabled`]: disabled,\r\n          [`${classPrefix}-is-selected`]: selected,\r\n          [`${classPrefix}-size-s`]: size === 'small',\r\n          [`${classPrefix}-size-l`]: size === 'large',\r\n        },\r\n      )}\r\n      key={value}\r\n      onClick={handleSelect}\r\n      ref={setRefCurrent}\r\n      style={style}\r\n    >\r\n      {renderItem(children)}\r\n    </li>\r\n  );\r\n};\r\n\r\nexport default Option;\r\n"],"names":["componentType","Option","props","propDisabled","disabled","propLabel","label","propTitle","title","selectedValue","checkAll","multiple","size","max","keys","value","onSelect","children","content","restData","style","className","isVirtual","selected","indeterminate","Array","isArray","length","titleContent","useMemo","controlledTitle","Reflect","has","_useConfig","useConfig","classPrefix","_useDomRefCallback","useDomRefCallback","_useDomRefCallback2","_slicedToArray","optionRef","setRefCurrent","useEffect","_props$onRowMounted","onRowMounted","call","ref","data","isNumber","isString","get","some","item","optionLength","handleSelect","event","String","_props$onCheckAllChan","onCheckAllChange","renderItem","React","createElement","classNames","concat","_defineProperty","type","onClick","e","stopPropagation","nativeEvent","stopImmediatePropagation","key"],"mappings":"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"}