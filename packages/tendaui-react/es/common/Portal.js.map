{"version":3,"file":"Portal.js","sources":["../../../components/common/Portal.tsx"],"sourcesContent":["import React, { forwardRef, useMemo, useImperativeHandle } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { AttachNode, AttachNodeReturnValue } from '../common';\r\nimport { canUseDocument } from '../utils/dom';\r\nimport useConfig from '../hooks/useConfig';\r\nimport useIsomorphicLayoutEffect from '../hooks/useLayoutEffect';\r\n\r\nexport interface PortalProps {\r\n  /**\r\n   * 指定挂载的 HTML 节点, false 为挂载在 body\r\n   */\r\n  attach?: React.ReactElement | AttachNode | boolean;\r\n  /**\r\n   * 触发元素\r\n   */\r\n  triggerNode?: HTMLElement;\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport function getAttach(\r\n  attach: PortalProps['attach'],\r\n  triggerNode?: HTMLElement,\r\n): AttachNodeReturnValue {\r\n  if (!canUseDocument) return null;\r\n\r\n  let el: AttachNodeReturnValue;\r\n  if (typeof attach === 'string') {\r\n    el = document.querySelector(attach);\r\n  }\r\n  if (typeof attach === 'function') {\r\n    el = attach(triggerNode);\r\n  }\r\n  if (typeof attach === 'object' && attach instanceof window.HTMLElement) {\r\n    el = attach;\r\n  }\r\n\r\n  // fix el in iframe\r\n  if (el && el.nodeType === 1) return el;\r\n\r\n  return document.body;\r\n}\r\n\r\nconst Portal = forwardRef((props: PortalProps, ref) => {\r\n  const { attach, children, triggerNode } = props;\r\n  const { classPrefix } = useConfig();\r\n\r\n  const container = useMemo(() => {\r\n    if (!canUseDocument) return null;\r\n    const el = document.createElement('div');\r\n    el.className = `${classPrefix}-portal-wrapper`;\r\n    return el;\r\n  }, [classPrefix]);\r\n\r\n  useIsomorphicLayoutEffect(() => {\r\n    const parentElement = getAttach(attach, triggerNode);\r\n    parentElement?.appendChild?.(container);\r\n\r\n    return () => {\r\n      parentElement?.removeChild?.(container);\r\n    };\r\n  }, [container, attach, triggerNode]);\r\n\r\n  useImperativeHandle(ref, () => container);\r\n\r\n  return canUseDocument ? createPortal(children, container) : null;\r\n});\r\n\r\nPortal.displayName = 'Portal';\r\n\r\nexport default Portal;\r\n"],"names":["getAttach","attach","triggerNode","canUseDocument","el","document","querySelector","_typeof","window","HTMLElement","nodeType","body","Portal","forwardRef","props","ref","children","_useConfig","useConfig","classPrefix","container","useMemo","createElement","className","concat","useIsomorphicLayoutEffect","_parentElement$append","parentElement","appendChild","call","_parentElement$remove","removeChild","useImperativeHandle","createPortal","displayName"],"mappings":";;;;;;;;AAmBO,SAASA,SAASA,CACvBC,MAA6B,EAC7BC,WAAyB,EACF;AACvB,EAAA,IAAI,CAACC,cAAc,EAAE,OAAO,IAAI;AAEhC,EAAA,IAAIC,EAAyB;AAC7B,EAAA,IAAI,OAAOH,MAAM,KAAK,QAAQ,EAAE;AAC9BG,IAAAA,EAAE,GAAGC,QAAQ,CAACC,aAAa,CAACL,MAAM,CAAC;AACrC,EAAA;AACA,EAAA,IAAI,OAAOA,MAAM,KAAK,UAAU,EAAE;AAChCG,IAAAA,EAAE,GAAGH,MAAM,CAACC,WAAW,CAAC;AAC1B,EAAA;EACA,IAAIK,OAAA,CAAON,MAAM,CAAA,KAAK,QAAQ,IAAIA,MAAM,YAAYO,MAAM,CAACC,WAAW,EAAE;AACtEL,IAAAA,EAAE,GAAGH,MAAM;AACb,EAAA;;AAEA;EACA,IAAIG,EAAE,IAAIA,EAAE,CAACM,QAAQ,KAAK,CAAC,EAAE,OAAON,EAAE;EAEtC,OAAOC,QAAQ,CAACM,IAAI;AACtB;AAEA,IAAMC,MAAM,gBAAGC,UAAU,CAAC,UAACC,KAAkB,EAAEC,GAAG,EAAK;AACrD,EAAA,IAAQd,MAAM,GAA4Ba,KAAK,CAAvCb,MAAM;IAAEe,QAAQ,GAAkBF,KAAK,CAA/BE,QAAQ;IAAEd,WAAW,GAAKY,KAAK,CAArBZ,WAAW;AACrC,EAAA,IAAAe,UAAA,GAAwBC,SAAS,EAAE;IAA3BC,WAAW,GAAAF,UAAA,CAAXE,WAAW;AAEnB,EAAA,IAAMC,SAAS,GAAGC,OAAO,CAAC,YAAM;AAC9B,IAAA,IAAI,CAAClB,cAAc,EAAE,OAAO,IAAI;AAChC,IAAA,IAAMC,EAAE,GAAGC,QAAQ,CAACiB,aAAa,CAAC,KAAK,CAAC;AACxClB,IAAAA,EAAE,CAACmB,SAAS,GAAA,EAAA,CAAAC,MAAA,CAAML,WAAW,EAAA,iBAAA,CAAiB;AAC9C,IAAA,OAAOf,EAAE;AACX,EAAA,CAAC,EAAE,CAACe,WAAW,CAAC,CAAC;AAEjBM,EAAAA,yBAAyB,CAAC,YAAM;AAAA,IAAA,IAAAC,qBAAA;AAC9B,IAAA,IAAMC,aAAa,GAAG3B,SAAS,CAACC,MAAM,EAAEC,WAAW,CAAC;AACpDyB,IAAAA,aAAa,aAAbA,aAAa,KAAA,KAAA,CAAA,IAAA,CAAAD,qBAAA,GAAbC,aAAa,CAAEC,WAAW,MAAA,IAAA,IAAAF,qBAAA,KAAA,KAAA,CAAA,IAA1BA,qBAAA,CAAAG,IAAA,CAAAF,aAAa,EAAgBP,SAAS,CAAC;AAEvC,IAAA,OAAO,YAAM;AAAA,MAAA,IAAAU,qBAAA;AACXH,MAAAA,aAAa,aAAbA,aAAa,KAAA,KAAA,CAAA,IAAA,CAAAG,qBAAA,GAAbH,aAAa,CAAEI,WAAW,MAAA,IAAA,IAAAD,qBAAA,KAAA,KAAA,CAAA,IAA1BA,qBAAA,CAAAD,IAAA,CAAAF,aAAa,EAAgBP,SAAS,CAAC;IACzC,CAAC;EACH,CAAC,EAAE,CAACA,SAAS,EAAEnB,MAAM,EAAEC,WAAW,CAAC,CAAC;EAEpC8B,mBAAmB,CAACjB,GAAG,EAAE,YAAA;AAAA,IAAA,OAAMK,SAAS;EAAA,CAAA,CAAC;EAEzC,OAAOjB,cAAc,gBAAG8B,YAAY,CAACjB,QAAQ,EAAEI,SAAS,CAAC,GAAG,IAAI;AAClE,CAAC;AAEDR,MAAM,CAACsB,WAAW,GAAG,QAAQ;;;;"}