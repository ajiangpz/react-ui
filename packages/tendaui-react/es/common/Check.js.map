{"version":3,"file":"Check.js","sources":["../../../components/common/Check.tsx"],"sourcesContent":["import React, { forwardRef, useContext, MouseEvent, ChangeEvent } from 'react';\r\nimport classNames from 'classnames';\r\nimport { isBoolean } from 'lodash-es';\r\nimport { omit } from '../utils/helper';\r\nimport { StyledProps } from '../common';\r\nimport useConfig from '../hooks/useConfig';\r\nimport useControlled from '../hooks/useControlled';\r\nimport { TdCheckboxProps } from '../checkbox/type';\r\n\r\nexport interface CheckProps extends TdCheckboxProps, StyledProps {\r\n    type: 'radio' | 'radio-button' | 'checkbox';\r\n    allowUncheck?: boolean;\r\n    title?: string;\r\n    children?: React.ReactNode;\r\n    stopLabelTrigger?: Boolean;\r\n}\r\n\r\n/**\r\n * Check 组件支持使用 CheckContext 进行状态托管\r\n */\r\nexport const CheckContext = React.createContext<CheckContextValue>(null);\r\n\r\n/**\r\n * 托管 Check 组件的状态，请提供 inject() 方法注入托管好的 props\r\n */\r\nexport interface CheckContextValue {\r\n    inject: (props: CheckProps) => CheckProps;\r\n}\r\n\r\nconst Check = forwardRef<HTMLLabelElement, CheckProps>((_props, ref) => {\r\n    // 支持从 Context 注入\r\n    const context = useContext(CheckContext);\r\n    const props = context ? context.inject(_props) : _props;\r\n\r\n    const {\r\n        allowUncheck = false,\r\n        type,\r\n        disabled,\r\n        name,\r\n        value,\r\n        onChange,\r\n        indeterminate,\r\n        children,\r\n        label,\r\n        className,\r\n        style,\r\n        readonly,\r\n        onClick,\r\n        ...htmlProps\r\n    } = props;\r\n\r\n    const { classPrefix } = useConfig();\r\n\r\n    const TOnChange: (\r\n        checked: boolean,\r\n        context: { e: ChangeEvent<HTMLInputElement> | MouseEvent<HTMLInputElement> },\r\n    ) => void = onChange;\r\n\r\n    const [internalChecked, setInternalChecked] = useControlled(props, 'checked', TOnChange);\r\n\r\n    const labelClassName = classNames(`${classPrefix}-${type}`, className, {\r\n        [`${classPrefix}-is-checked`]: internalChecked,\r\n        [`${classPrefix}-is-disabled`]: disabled,\r\n        [`${classPrefix}-is-indeterminate`]: indeterminate,\r\n    });\r\n\r\n    const isDisabled = disabled || readonly;\r\n\r\n    const input = (\r\n        <input\r\n            readOnly={readonly}\r\n            type={type === 'radio-button' ? 'radio' : type}\r\n            className={`${classPrefix}-${type}__former`}\r\n            checked={internalChecked}\r\n            disabled={disabled}\r\n            name={name}\r\n            tabIndex={-1}\r\n            value={isBoolean(value) ? Number(value) : value}\r\n            data-value={typeof value === 'string' ? `'${value}'` : value}\r\n            data-allow-uncheck={allowUncheck || undefined}\r\n            onClick={(e) => {\r\n                e.stopPropagation();\r\n                if ((type === 'radio-button' || type === 'radio') && allowUncheck && internalChecked) {\r\n                    setInternalChecked(!e.currentTarget.checked, { e });\r\n                }\r\n            }}\r\n            onChange={(e) => {\r\n                if (isDisabled) return;\r\n                setInternalChecked(e.currentTarget.checked, { e });\r\n            }}\r\n        />\r\n    );\r\n    // Checkbox/ Radio 内容为空则不再渲染 span，不存在 0:Number 的情况\r\n    const showLabel = !!(children || label);\r\n\r\n    const handleLabelClick = (event: MouseEvent<HTMLSpanElement>) => {\r\n        // 在tree等组件中使用  阻止label触发checked 与expand冲突\r\n        if (props.stopLabelTrigger) {\r\n            event.preventDefault();\r\n        }\r\n    };\r\n\r\n    const onInnerClick = (e: MouseEvent<HTMLLabelElement>) => {\r\n        if (isDisabled) return;\r\n        onClick?.({ e });\r\n    };\r\n\r\n    return (\r\n        <label\r\n            ref={ref}\r\n            tabIndex={disabled ? undefined : 0}\r\n            className={labelClassName}\r\n            title={props.title}\r\n            style={style}\r\n            {...omit(htmlProps, ['checkAll', 'stopLabelTrigger'])}\r\n            onClick={onInnerClick}\r\n        >\r\n            {input}\r\n            <span className={`${classPrefix}-${type}__input`} />\r\n            {showLabel && (\r\n                <span key=\"label\" className={`${classPrefix}-${type}__label`} onClick={handleLabelClick}>\r\n                    {children || label}\r\n                </span>\r\n            )}\r\n        </label>\r\n    );\r\n});\r\n\r\nCheck.displayName = 'Check';\r\n\r\nexport default Check;\r\n"],"names":["CheckContext","React","createContext","Check","forwardRef","_props","ref","context","useContext","props","inject","_props$allowUncheck","allowUncheck","type","disabled","name","value","onChange","indeterminate","children","label","className","style","readonly","onClick","htmlProps","_objectWithoutProperties","_excluded","_useConfig","useConfig","classPrefix","TOnChange","_useControlled","useControlled","_useControlled2","_slicedToArray","internalChecked","setInternalChecked","labelClassName","classNames","concat","_defineProperty","isDisabled","input","createElement","readOnly","checked","tabIndex","isBoolean","Number","undefined","e","stopPropagation","currentTarget","showLabel","handleLabelClick","event","stopLabelTrigger","preventDefault","onInnerClick","_extends","title","omit","key","displayName"],"mappings":"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"}