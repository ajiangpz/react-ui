{"version":3,"file":"NotifyItem.js","sources":["../../../components/notification/NotifyItem.tsx"],"sourcesContent":["import React, { useLayoutEffect, useRef, useState } from \"react\";\r\nimport { XCircle, CheckCircle, AlertCircle, Info } from \"lucide-react\";\r\nimport useConfig from \"../hooks/useConfig\";\r\n\r\nconst NotificationItem: React.FC<{\r\n  id: string;\r\n  message: string;\r\n  type: string;\r\n  heights: { toastId: string; height: number }[];\r\n  gap: number;\r\n  setHeights: React.Dispatch<\r\n    React.SetStateAction<\r\n      { toastId: string; height: number; message: string; type: string }[]\r\n    >\r\n  >;\r\n  isRemoved: boolean;\r\n  isExpanded: boolean;\r\n  title: string\r\n}> = ({\r\n  message,\r\n  type,\r\n  heights,\r\n  setHeights,\r\n  id,\r\n  gap,\r\n  isExpanded,\r\n  isRemoved,\r\n  title\r\n}) => {\r\n    const [initialHeight, setInitialHeight] = useState(0);\r\n    const [isMounted, setIsMounted] = useState(false);\r\n    const nofityItem = useRef<HTMLDivElement>(null);\r\n    const { classPrefix: prefix } = useConfig();\r\n    React.useEffect(() => {\r\n      setIsMounted(true);\r\n    }, []);\r\n\r\n    React.useEffect(() => {\r\n      const notifyNode = nofityItem.current;\r\n      if (notifyNode) {\r\n        const height = notifyNode.getBoundingClientRect().height;\r\n        setInitialHeight(height);\r\n        setHeights(h => {\r\n          // 如果不存在，则添加\r\n          return [{ toastId: id, height, message, type }, ...h];\r\n        });\r\n        return () => {\r\n          setHeights(h => h.filter(h => h.toastId !== id));\r\n        };\r\n      }\r\n    }, [setHeights, id]);\r\n\r\n    useLayoutEffect(() => {\r\n      if (!isMounted) return;\r\n      const notifyNode = nofityItem.current;\r\n      if (notifyNode) {\r\n        const originalHeight = notifyNode.style.height;\r\n        notifyNode.style.height = \"auto\";\r\n        const newHeight = notifyNode.getBoundingClientRect().height;\r\n        notifyNode.style.height = originalHeight;\r\n        setInitialHeight(newHeight);\r\n        setHeights(heights => {\r\n          const isExist = heights.some(h => h.toastId === id);\r\n          if (isExist) {\r\n            // 如果存在，则更新高度\r\n            return heights.map(h =>\r\n              h.toastId === id ? { ...h, height: newHeight, message, type } : h\r\n            );\r\n          }\r\n          // 如果不存在，则添加\r\n          return [{ toastId: id, height: newHeight, message, type }, ...heights];\r\n        });\r\n      }\r\n    }, [isMounted, initialHeight, setHeights, id, message, type]);\r\n    const heightIndex = React.useMemo(() => {\r\n      return heights.findIndex(h => h.toastId === id);\r\n    }, [heights, id]);\r\n    const toastHeightBefore = React.useMemo(() => {\r\n      return heights.reduce((acc, h, reduceIndex) => {\r\n        if (reduceIndex < heightIndex) {\r\n          return acc + h.height;\r\n        }\r\n        return acc;\r\n      }, 0);\r\n    }, [initialHeight, heightIndex, heights]);\r\n\r\n    const offset = React.useMemo(\r\n      () => heightIndex * gap + toastHeightBefore,\r\n      [toastHeightBefore, heightIndex]\r\n    );\r\n\r\n    return (\r\n      <div\r\n\r\n        className={`${prefix}-notify__item`}\r\n        ref={nofityItem}\r\n        style={\r\n          {\r\n            position: \"absolute\",\r\n            height: isExpanded ? `auto` : `var(--front-toast-height)`,\r\n            width: `var(--toast-width)`,\r\n            \"--offset\": offset + \"px\",\r\n            \"--index\": heightIndex,\r\n            \"--gap\": gap + \"px\",\r\n            \"--z-index\": heights.length - heightIndex\r\n          } as React.CSSProperties\r\n        }\r\n        data-toast\r\n        data-mounted={isMounted}\r\n        data-expanded={isExpanded}\r\n        data-removed={isRemoved}\r\n        data-front={heightIndex === 0}\r\n      >\r\n        <div className={`${prefix}-notify__content`}>\r\n\r\n          <div className={`${prefix}-notify__header`}>\r\n            <div className={`${prefix}-notify__icon`} >\r\n              {type === \"success\" && <CheckCircle className=\"t-icon t-is-success\" />}\r\n              {type === \"error\" && <XCircle className=\"t-icon t-is-error\" />}\r\n              {type === \"info\" && <Info className=\"t-icon t-is-info\" />}\r\n              {type === \"warning\" && <AlertCircle className=\"t-icon t-is-warning\" />}\r\n              {type === \"default\" && <Info className=\"t-icon t-is-info\" />}\r\n            </div>\r\n\r\n            <div className={`${prefix}-notify__title`}>{title}</div>\r\n          </div>\r\n\r\n        </div>\r\n        <p className={`${prefix}-notify__detail`} style={{ opacity: heightIndex === 0 || isExpanded ? 1 : 0, transition: `opacity 400ms` }}>{message}</p>\r\n      </div>\r\n    );\r\n  };\r\n\r\nexport default NotificationItem;\r\n"],"names":["NotificationItem","_ref","message","type","heights","setHeights","id","gap","isExpanded","isRemoved","title","_useState","useState","_useState2","_slicedToArray","initialHeight","setInitialHeight","_useState3","_useState4","isMounted","setIsMounted","nofityItem","useRef","_useConfig","useConfig","prefix","classPrefix","React","useEffect","notifyNode","current","height","getBoundingClientRect","h","toastId","concat","_toConsumableArray","filter","useLayoutEffect","originalHeight","style","newHeight","isExist","some","map","_objectSpread","heightIndex","useMemo","findIndex","toastHeightBefore","reduce","acc","reduceIndex","offset","createElement","className","ref","position","width","length","CheckCircle","XCircle","Info","AlertCircle","opacity","transition"],"mappings":"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"}