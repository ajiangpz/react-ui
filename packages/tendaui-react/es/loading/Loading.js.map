{"version":3,"file":"Loading.js","sources":["../../../components/loading/defaultProps.ts","../../../components/loading/Loading.tsx"],"sourcesContent":["import { TdLoadingProps } from './type';\r\n\r\nexport const loadingDefaultProps: TdLoadingProps = {\r\n  delay: 0,\r\n  fullscreen: false,\r\n  indicator: true,\r\n  inheritColor: false,\r\n  loading: true,\r\n  preventScrollThrough: true,\r\n  showOverlay: true,\r\n  size: 'medium',\r\n};\r\n","import React, { useState, useEffect, useMemo, CSSProperties } from 'react';\r\nimport classnames from 'classnames';\r\nimport { canUseDocument } from '../utils/dom';\r\nimport useConfig from '../hooks/useConfig';\r\nimport { StyledProps } from '../common';\r\nimport { TdLoadingProps } from './type';\r\nimport Portal from '../common/Portal';\r\nimport Gradient from './Gradient';\r\nimport { loadingDefaultProps } from './defaultProps';\r\nimport useDefaultProps from '../hooks/useDefaultProps';\r\nimport { addClass, removeClass } from '../utils/style';\r\n\r\nexport interface LoadingProps extends TdLoadingProps, StyledProps { }\r\n\r\nconst Loading: React.FC<LoadingProps> = (props) => {\r\n  const {\r\n    attach,\r\n    indicator,\r\n    text,\r\n    loading,\r\n    size,\r\n    delay,\r\n    fullscreen,\r\n    preventScrollThrough,\r\n    showOverlay,\r\n    content,\r\n    children,\r\n    inheritColor,\r\n    zIndex,\r\n    className,\r\n    style,\r\n  } = useDefaultProps<LoadingProps>(props, loadingDefaultProps);\r\n\r\n  const [showLoading, setShowLoading] = useState(() =>\r\n    delay ? false : loading,\r\n  );\r\n\r\n  const { classPrefix } = useConfig();\r\n\r\n  const name = `${classPrefix}-loading`;\r\n  const centerClass = `${classPrefix}-loading--center`;\r\n  const inheritColorClass = `${classPrefix}-loading--inherit-color`;\r\n  const fullClass = `${classPrefix}-loading--full`;\r\n  const fullscreenClass = `${classPrefix}-loading__fullscreen`;\r\n  const lockClass = `${classPrefix}-loading--lock`;\r\n  const overlayClass = `${classPrefix}-loading__overlay`;\r\n  const relativeClass = `${classPrefix}-loading__parent`;\r\n  const textClass = `${classPrefix}-loading__text`;\r\n\r\n  useEffect(() => {\r\n    let timer: NodeJS.Timeout;\r\n\r\n    if (delay && loading) {\r\n      timer = setTimeout(() => {\r\n        setShowLoading(loading);\r\n      }, delay);\r\n    } else {\r\n      setShowLoading(loading);\r\n    }\r\n    return () => {\r\n      clearTimeout(timer);\r\n    };\r\n  }, [delay, loading]);\r\n\r\n  const calcStyles = useMemo<React.CSSProperties>(() => {\r\n    const styles: CSSProperties = {};\r\n\r\n    if (zIndex !== undefined) {\r\n      styles.zIndex = zIndex;\r\n    }\r\n\r\n    if (!['small', 'medium', 'large'].includes(size)) {\r\n      styles.fontSize = size;\r\n    }\r\n\r\n    return styles;\r\n  }, [size, zIndex]);\r\n\r\n  const sizeMap = {\r\n    large: `${classPrefix}-size-l`,\r\n    small: `${classPrefix}-size-s`,\r\n    medium: `${classPrefix}-size-m`,\r\n  };\r\n\r\n  const baseClasses = classnames(\r\n    centerClass,\r\n    sizeMap[size],\r\n    {\r\n      [inheritColorClass]: inheritColor,\r\n    },\r\n    className,\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (preventScrollThrough && fullscreen && canUseDocument && loading) {\r\n      addClass(document.body, lockClass);\r\n    }\r\n    return () => {\r\n      removeClass(document.body, lockClass);\r\n    };\r\n  }, [loading, preventScrollThrough, fullscreen, lockClass]);\r\n\r\n  const commonContent = () => {\r\n    let renderIndicator = <Gradient />;\r\n\r\n    if (indicator && typeof indicator !== 'boolean') {\r\n      renderIndicator = indicator as React.ReactElement;\r\n    }\r\n    return (\r\n      <>\r\n        {indicator ? renderIndicator : null}\r\n        {text ? <div className={textClass}>{text}</div> : null}\r\n      </>\r\n    );\r\n  };\r\n\r\n  if (fullscreen) {\r\n    return loading ? (\r\n      <div\r\n        className={classnames(name, fullscreenClass, centerClass, overlayClass)}\r\n        style={{ ...calcStyles, ...style }}\r\n      >\r\n        <div className={baseClasses}>{commonContent()}</div>\r\n      </div>\r\n    ) : null;\r\n  }\r\n\r\n  if (content || children) {\r\n    return (\r\n      <div className={relativeClass} style={style}>\r\n        {content || children}\r\n        {showLoading ? (\r\n          <div\r\n            className={classnames(name, baseClasses, fullClass, {\r\n              [overlayClass]: showOverlay,\r\n            })}\r\n            style={calcStyles}\r\n          >\r\n            {commonContent()}\r\n          </div>\r\n        ) : null}\r\n      </div>\r\n    );\r\n  }\r\n  if (attach) {\r\n    return (\r\n      <Portal attach={attach}>\r\n        {loading ? (\r\n          <div\r\n            className={classnames(name, baseClasses, fullClass, {\r\n              [overlayClass]: showOverlay,\r\n            })}\r\n            style={{ ...calcStyles, ...style }}\r\n          >\r\n            {commonContent()}\r\n          </div>\r\n        ) : null}\r\n      </Portal>\r\n    );\r\n  }\r\n\r\n  return loading ? (\r\n    <div\r\n      className={classnames(name, baseClasses)}\r\n      style={{ ...calcStyles, ...style }}\r\n    >\r\n      {commonContent()}\r\n    </div>\r\n  ) : null;\r\n};\r\n\r\nLoading.displayName = 'Loading';\r\n\r\nexport default Loading;\r\n"],"names":["loadingDefaultProps","delay","fullscreen","indicator","inheritColor","loading","preventScrollThrough","showOverlay","size","Loading","props","_useDefaultProps","useDefaultProps","attach","text","content","children","zIndex","className","style","_useState","useState","_useState2","_slicedToArray","showLoading","setShowLoading","_useConfig","useConfig","classPrefix","name","concat","centerClass","inheritColorClass","fullClass","fullscreenClass","lockClass","overlayClass","relativeClass","textClass","useEffect","timer","setTimeout","clearTimeout","calcStyles","useMemo","styles","undefined","includes","fontSize","sizeMap","large","small","medium","baseClasses","classnames","_defineProperty","canUseDocument","addClass","document","body","removeClass","commonContent","renderIndicator","React","createElement","Gradient","Fragment","_objectSpread","Portal","displayName"],"mappings":"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"}