{"version":3,"file":"Portal.js","sources":["../../../components/portal/Portal.tsx"],"sourcesContent":["import React, { forwardRef, useMemo, useImperativeHandle } from 'react';\nimport { createPortal } from 'react-dom';\nimport { canUseDocument } from '../utils/dom';\nimport { AttachNode, AttachNodeReturnValue } from '@/common';\nimport useIsomorphicLayoutEffect from '../hooks/useLayoutEffect';\n\nexport interface PortalProps {\n  /**\n   * 指定挂载的 HTML 节点, false 为挂载在 body\n   */\n  attach?: React.ReactElement | AttachNode | boolean;\n  /**\n   * 触发元素\n   */\n  triggerNode?: HTMLElement;\n  children: React.ReactNode;\n}\n// 获取挂载的 HTML 节点\n\nexport function getAttach(\n  attach: PortalProps['attach'],\n  triggerNode?: HTMLElement,\n): AttachNodeReturnValue {\n  if (!canUseDocument) return null;\n\n  let el: AttachNodeReturnValue = null;\n  if (typeof attach === 'string') {\n    el = document.querySelector(attach);\n  }\n  if (typeof attach === 'function') {\n    el = attach(triggerNode);\n  }\n  if (typeof attach === 'object' && attach instanceof window.HTMLElement) {\n    el = attach;\n  }\n\n  // fix el in iframe\n  if (el && el.nodeType === 1) return el;\n\n  return document.body;\n}\n\nconst Portal = forwardRef((props: PortalProps, ref) => {\n  const { attach, children, triggerNode } = props;\n  const container = useMemo(() => {\n    const div = document.createElement('div');\n    div.className = 'portal-container bg-primary';\n    return div;\n  }, []);\n  // 兼容 SSR 环境\n  useIsomorphicLayoutEffect(() => {\n    const parentElement = getAttach(attach, triggerNode);\n    parentElement?.appendChild?.(container);\n    // Clean up the container when the component unmounts\n    return () => {\n      parentElement?.removeChild?.(container);\n    };\n  }, [container, attach, triggerNode]);\n  // 自定义暴露给父组件的ref是container\n  useImperativeHandle(ref, () => container);\n\n  return canUseDocument ? createPortal(children, container) : null;\n});\n\nPortal.displayName = 'Portal';\nexport default Portal;\n"],"names":["getAttach","attach","triggerNode","canUseDocument","el","document","querySelector","_typeof","window","HTMLElement","nodeType","body","Portal","forwardRef","props","ref","children","container","useMemo","div","createElement","className","useIsomorphicLayoutEffect","_parentElement$append","parentElement","appendChild","call","_parentElement$remove","removeChild","useImperativeHandle","createPortal","displayName"],"mappings":";;;;;;AAmBO,SAASA,SAAAA,CACdC,QACAC,WAAA,EACuB;AACvB,EAAA,IAAI,CAACC,gBAAgB,OAAO,IAAA;EAE5B,IAAIC,EAAA,GAA4B,IAAA;AAChC,EAAA,IAAI,OAAOH,WAAW,QAAA,EAAU;AAC9BG,IAAAA,EAAA,GAAKC,QAAA,CAASC,cAAcL,MAAM,CAAA;AACpC,EAAA;AACA,EAAA,IAAI,OAAOA,WAAW,UAAA,EAAY;AAChCG,IAAAA,EAAA,GAAKH,OAAOC,WAAW,CAAA;AACzB,EAAA;EACA,IAAIK,OAAA,CAAON,MAAA,CAAA,KAAW,QAAA,IAAYA,MAAA,YAAkBO,OAAOC,WAAA,EAAa;AACtEL,IAAAA,EAAA,GAAKH,MAAA;AACP,EAAA;EAGA,IAAIG,EAAA,IAAMA,EAAA,CAAGM,QAAA,KAAa,CAAA,EAAG,OAAON,EAAA;EAEpC,OAAOC,QAAA,CAASM,IAAA;AAClB;AAEA,IAAMC,MAAA,gBAASC,uBAAA,CAAW,UAACC,KAAA,EAAoBC,GAAA,EAAQ;AACrD,EAAA,IAAQd,MAAA,GAAkCa,KAAA,CAAlCb,MAAA;IAAQe,QAAA,GAA0BF,KAAA,CAA1BE,QAAA;IAAUd,WAAA,GAAgBY,KAAA,CAAhBZ,WAAA;AAC1B,EAAA,IAAMe,SAAA,GAAYC,qBAAQ,YAAM;AAC9B,IAAA,IAAMC,GAAA,GAAMd,QAAA,CAASe,aAAA,CAAc,KAAK,CAAA;IACxCD,GAAA,CAAIE,SAAA,GAAY,6BAAA;AAChB,IAAA,OAAOF,GAAA;EACT,CAAA,EAAG,EAAE,CAAA;AAELG,EAAAA,yBAAA,CAA0B,YAAM;AAAA,IAAA,IAAAC,qBAAA;AAC9B,IAAA,IAAMC,aAAA,GAAgBxB,SAAA,CAAUC,MAAA,EAAQC,WAAW,CAAA;AACnDsB,IAAAA,aAAA,aAAAA,aAAA,KAAA,KAAA,CAAA,IAAA,CAAAD,qBAAA,GAAAC,aAAA,CAAeC,6DAAfF,qBAAA,CAAAG,IAAA,CAAAF,aAAA,EAA6BP,SAAS,CAAA;AAEtC,IAAA,OAAO,YAAM;AAAA,MAAA,IAAAU,qBAAA;AACXH,MAAAA,aAAA,aAAAA,aAAA,KAAA,KAAA,CAAA,IAAA,CAAAG,qBAAA,GAAAH,aAAA,CAAeI,6DAAfD,qBAAA,CAAAD,IAAA,CAAAF,aAAA,EAA6BP,SAAS,CAAA;IACxC,CAAA;EACF,CAAA,EAAG,CAACA,SAAA,EAAWhB,MAAA,EAAQC,WAAW,CAAC,CAAA;EAEnC2B,gCAAA,CAAoBd,GAAA,EAAK,YAAA;AAAA,IAAA,OAAME,SAAS;EAAA,CAAA,CAAA;EAExC,OAAOd,cAAA,gBAAiB2B,4BAAA,CAAad,QAAA,EAAUC,SAAS,CAAA,GAAI,IAAA;AAC9D,CAAC;AAEDL,MAAA,CAAOmB,WAAA,GAAc,QAAA;;;;"}