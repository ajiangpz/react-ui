{"version":3,"file":"ConfigProvider.js","sources":["../../../components/config-provider/ConfigProvider.tsx"],"sourcesContent":["import React, { useEffect } from 'react';\nimport { mergeWith as _mergeWith, cloneDeep } from 'lodash-es';\nimport ConfigContext, { defaultGlobalConfig, Config } from './ConfigContext';\nimport { GlobalConfigProvider } from './type';\n\nexport interface ConfigProviderProps extends Config {\n  children: React.ReactNode;\n  /**\n   * 不需要设置全局上下文信息 \n   * 不传或者false：表示全局上下文变动，需要更新全局上下文的信息放入到变量中\n   * true：表示全局上下文信息不需要重新设置，\n   * 解决问题：当plugin调用的时候，单独包裹的Provider 也会传全局变量，仅自身可用，多次调用时相互之间不会冲突。\n   * 插件单独的config方法依然可用。自身属性通过props传递\n   * 例如：多处调用message.config 如果每次都更新全局上下文，插件调用时配置会相互影响，导致行为结果跟预期不一致。\n   */\n  notSet?: boolean;\n}\n\nexport const merge = (src: GlobalConfigProvider, config: GlobalConfigProvider) =>\n  _mergeWith(src, config, (objValue, srcValue) => {\n    if (Array.isArray(objValue)) {\n      return srcValue;\n    }\n  });\n\n// 存放全局的上下文配置\nlet globalConfig = defaultGlobalConfig;\n\nexport const getGlobalConfig = (configInfo?: GlobalConfigProvider): GlobalConfigProvider => merge({ ...globalConfig }, configInfo)\n\nexport const setGlobalConfig = (configInfo?: GlobalConfigProvider) => {\n  globalConfig = configInfo\n}\n\n\nexport default function ConfigProvider({ children, globalConfig, notSet }: ConfigProviderProps) {\n  const defaultData = cloneDeep(defaultGlobalConfig);\n  const mergedGlobalConfig = merge(defaultData, globalConfig);\n\n  useEffect(() => {\n    if (!notSet) {\n      // 需要设置的情况下，当配置信息变化时更新变量中的配置信息，方便plugin调用时获取\n      setGlobalConfig(mergedGlobalConfig)\n    }\n  }, [mergedGlobalConfig, notSet]);\n\n  return <ConfigContext.Provider value={{ globalConfig: mergedGlobalConfig }}>{children}</ConfigContext.Provider>;\n}\n\nConfigProvider.getGlobalConfig = getGlobalConfig;\nConfigProvider.setGlobalConfig = setGlobalConfig;\n\nConfigProvider.displayName = 'ConfigProvider';\n"],"names":["merge","src","config","_mergeWith","objValue","srcValue","Array","isArray","globalConfig","defaultGlobalConfig","getGlobalConfig","configInfo","_objectSpread","setGlobalConfig","ConfigProvider","children","_ref","notSet","defaultData","cloneDeep","mergedGlobalConfig","useEffect","React","createElement","ConfigContext","Provider","value","displayName"],"mappings":";;;;;;;;AAkBO,IAAMA,KAAA,GAAQ,SAARA,KAAAA,CAASC,GAAA,EAA2BC,MAAA,EAAA;EAAA,OAC/CC,UAAWF,GAAA,EAAKC,MAAA,EAAQ,UAACE,QAAA,EAAUC,QAAA,EAAa;AAC9C,IAAA,IAAIC,KAAA,CAAMC,OAAA,CAAQH,QAAQ,CAAA,EAAG;AAC3B,MAAA,OAAOC,QAAA;AACT,IAAA;AACF,EAAA,CAAC,CAAA;AAAA;AAGH,IAAIG,YAAA,GAAeC,mBAAA;IAENC,eAAA,GAAkB,SAAlBA,eAAAA,CAAmBC,UAAA,EAAA;AAAA,EAAA,OAA4DX,KAAA,CAAAY,aAAA,KAAWJ,YAAA,CAAA,EAAgBG,UAAU,CAAA;AAAA;IAEpHE,eAAA,GAAkB,SAAlBA,eAAAA,CAAmBF,UAAA,EAAsC;AACpEH,EAAAA,YAAA,GAAeG,UAAA;AACjB;AAGA,SAAwBG,qBAAwE;AAAA,EAAA,IAAvDC,QAAA,GAAAC,IAAA,CAAAD,QAAA;IAAUP,aAAAA,GAAAA,IAAAA,CAAAA,YAAA;IAAcS,cAAAA;AAC/D,EAAA,IAAMC,WAAA,GAAcC,UAAUV,mBAAmB,CAAA;AACjD,EAAA,IAAMW,kBAAA,GAAqBpB,KAAA,CAAMkB,WAAA,EAAaV,aAAY,CAAA;AAE1Da,EAAAA,sBAAA,CAAU,YAAM;IACd,IAAI,CAACJ,MAAA,EAAQ;MAEXJ,eAAA,CAAgBO,kBAAkB,CAAA;AACpC,IAAA;AACF,EAAA,CAAA,EAAG,CAACA,kBAAA,EAAoBH,MAAM,CAAC,CAAA;EAE/B,sBAAOK,KAAA,CAAAC,aAAA,CAACC,cAAcC,QAAA,EAAd;AAAuBC,IAAAA,OAAO;AAAElB,MAAAA,YAAA,EAAcY;AAAmB;GAAA,EAAIL,QAAS,CAAA;AACxF;AAEAD,cAAA,CAAeJ,eAAA,GAAkBA,eAAA;AACjCI,cAAA,CAAeD,eAAA,GAAkBA,eAAA;AAEjCC,cAAA,CAAea,WAAA,GAAc,gBAAA;;;;"}