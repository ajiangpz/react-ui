{"version":3,"file":"Loading.js","sources":["../../../components/loading/defaultProps.ts","../../../components/loading/Loading.tsx"],"sourcesContent":["import { TdLoadingProps } from './type';\n\nexport const loadingDefaultProps: TdLoadingProps = {\n  delay: 0,\n  fullscreen: false,\n  indicator: true,\n  inheritColor: false,\n  loading: true,\n  preventScrollThrough: true,\n  showOverlay: true,\n  size: 'medium',\n};\n","import React, { useState, useEffect, useMemo, CSSProperties } from 'react';\nimport classnames from 'classnames';\nimport { canUseDocument } from '../utils/dom';\nimport useConfig from '../hooks/useConfig';\nimport { StyledProps } from '../common';\nimport { TdLoadingProps } from './type';\nimport Portal from '../common/Portal';\nimport Gradient from './Gradient';\nimport { loadingDefaultProps } from './defaultProps';\nimport useDefaultProps from '../hooks/useDefaultProps';\nimport { addClass, removeClass } from '../utils/style';\n\nexport interface LoadingProps extends TdLoadingProps, StyledProps { }\n\nconst Loading: React.FC<LoadingProps> = (props) => {\n  const {\n    attach,\n    indicator,\n    text,\n    loading,\n    size,\n    delay,\n    fullscreen,\n    preventScrollThrough,\n    showOverlay,\n    content,\n    children,\n    inheritColor,\n    zIndex,\n    className,\n    style,\n  } = useDefaultProps<LoadingProps>(props, loadingDefaultProps);\n\n  const [showLoading, setShowLoading] = useState(() =>\n    delay ? false : loading,\n  );\n\n  const { classPrefix } = useConfig();\n\n  const name = `${classPrefix}-loading`;\n  const centerClass = `${classPrefix}-loading--center`;\n  const inheritColorClass = `${classPrefix}-loading--inherit-color`;\n  const fullClass = `${classPrefix}-loading--full`;\n  const fullscreenClass = `${classPrefix}-loading__fullscreen`;\n  const lockClass = `${classPrefix}-loading--lock`;\n  const overlayClass = `${classPrefix}-loading__overlay`;\n  const relativeClass = `${classPrefix}-loading__parent`;\n  const textClass = `${classPrefix}-loading__text`;\n\n  useEffect(() => {\n    let timer: NodeJS.Timeout;\n\n    if (delay && loading) {\n      timer = setTimeout(() => {\n        setShowLoading(loading);\n      }, delay);\n    } else {\n      setShowLoading(loading);\n    }\n    return () => {\n      clearTimeout(timer);\n    };\n  }, [delay, loading]);\n\n  const calcStyles = useMemo<React.CSSProperties>(() => {\n    const styles: CSSProperties = {};\n\n    if (zIndex !== undefined) {\n      styles.zIndex = zIndex;\n    }\n\n    if (!['small', 'medium', 'large'].includes(size)) {\n      styles.fontSize = size;\n    }\n\n    return styles;\n  }, [size, zIndex]);\n\n  const sizeMap = {\n    large: `${classPrefix}-size-l`,\n    small: `${classPrefix}-size-s`,\n    medium: `${classPrefix}-size-m`,\n  };\n\n  const baseClasses = classnames(\n    centerClass,\n    sizeMap[size],\n    {\n      [inheritColorClass]: inheritColor,\n    },\n    className,\n  );\n\n  useEffect(() => {\n    if (preventScrollThrough && fullscreen && canUseDocument && loading) {\n      addClass(document.body, lockClass);\n    }\n    return () => {\n      removeClass(document.body, lockClass);\n    };\n  }, [loading, preventScrollThrough, fullscreen, lockClass]);\n\n  const commonContent = () => {\n    let renderIndicator = <Gradient />;\n\n    if (indicator && typeof indicator !== 'boolean') {\n      renderIndicator = indicator as React.ReactElement;\n    }\n    return (\n      <>\n        {indicator ? renderIndicator : null}\n        {text ? <div className={textClass}>{text}</div> : null}\n      </>\n    );\n  };\n\n  if (fullscreen) {\n    return loading ? (\n      <div\n        className={classnames(name, fullscreenClass, centerClass, overlayClass)}\n        style={{ ...calcStyles, ...style }}\n      >\n        <div className={baseClasses}>{commonContent()}</div>\n      </div>\n    ) : null;\n  }\n\n  if (content || children) {\n    return (\n      <div className={relativeClass} style={style}>\n        {content || children}\n        {showLoading ? (\n          <div\n            className={classnames(name, baseClasses, fullClass, {\n              [overlayClass]: showOverlay,\n            })}\n            style={calcStyles}\n          >\n            {commonContent()}\n          </div>\n        ) : null}\n      </div>\n    );\n  }\n  if (attach) {\n    return (\n      <Portal attach={attach}>\n        {loading ? (\n          <div\n            className={classnames(name, baseClasses, fullClass, {\n              [overlayClass]: showOverlay,\n            })}\n            style={{ ...calcStyles, ...style }}\n          >\n            {commonContent()}\n          </div>\n        ) : null}\n      </Portal>\n    );\n  }\n\n  return loading ? (\n    <div\n      className={classnames(name, baseClasses)}\n      style={{ ...calcStyles, ...style }}\n    >\n      {commonContent()}\n    </div>\n  ) : null;\n};\n\nLoading.displayName = 'Loading';\n\nexport default Loading;\n"],"names":["loadingDefaultProps","delay","fullscreen","indicator","inheritColor","loading","preventScrollThrough","showOverlay","size","Loading","props","_useDefaultProps","useDefaultProps","attach","text","content","children","zIndex","className","style","_useState","useState","_useState2","_slicedToArray","showLoading","setShowLoading","_useConfig","useConfig","classPrefix","name","concat","centerClass","inheritColorClass","fullClass","fullscreenClass","lockClass","overlayClass","relativeClass","textClass","useEffect","timer","setTimeout","clearTimeout","calcStyles","useMemo","styles","includes","fontSize","sizeMap","large","small","medium","baseClasses","classnames","_defineProperty","canUseDocument","addClass","document","body","removeClass","commonContent","renderIndicator","Gradient","React","createElement","Fragment","_objectSpread","Portal","displayName"],"mappings":"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"}