{"version":3,"file":"Switch.js","sources":["../../../components/Switch/defaultProps.ts","../../../components/Switch/Switch.tsx"],"sourcesContent":["\nimport { TdSwitchProps } from './type';\n\nexport const switchDefaultProps: TdSwitchProps = { label: [], loading: false, size: 'medium' };\n","import React, { useEffect, useState } from 'react';\nimport classNames from 'classnames';\nimport Loading from '../loading';\nimport useConfig from '../hooks/useConfig';\nimport { StyledProps } from '../common';\nimport useCommonClassName from '../hooks/useCommonClassName';\nimport { SwitchValue, TdSwitchProps } from './type';\nimport { switchDefaultProps } from './defaultProps';\nimport parseTNode from '../utils/parentTNode';\nimport useDefaultProps from '../hooks/useDefaultProps';\n\nexport type SwitchChangeEventHandler = (value: boolean, event: React.MouseEvent<HTMLButtonElement>) => void;\nexport type SwitchClickEventHandler = SwitchChangeEventHandler;\n\nexport interface SwitchProps<T extends SwitchValue = SwitchValue> extends TdSwitchProps<T>, StyledProps { }\n\nconst Switch = React.forwardRef<HTMLButtonElement, SwitchProps>((originalProps, ref) => {\n  const { classPrefix } = useConfig();\n  const props = useDefaultProps<SwitchProps<SwitchValue>>(originalProps, switchDefaultProps);\n  const {\n    className,\n    value,\n    defaultValue,\n    disabled,\n    loading,\n    size,\n    label,\n    customValue,\n    onChange,\n    beforeChange,\n    ...restProps\n  } = props;\n  const [activeValue = true, inactiveValue = false] = customValue || [];\n\n  const isControlled = typeof value !== 'undefined';\n  const initChecked = defaultValue === activeValue || value === activeValue;\n  const [innerChecked, setInnerChecked] = useState(initChecked);\n\n  const contentNode = React.useMemo<React.ReactNode>(() => {\n    if (Array.isArray(label)) {\n      const [activeContent = '', inactiveContent = ''] = label;\n      const content = innerChecked ? activeContent : inactiveContent;\n      return parseTNode(content, { value });\n    }\n    return parseTNode(label, { value });\n  }, [label, innerChecked, value]);\n\n  const handleChange = (e: React.MouseEvent) => {\n    !isControlled && setInnerChecked(!innerChecked);\n    const changedValue = !innerChecked ? activeValue : inactiveValue;\n    onChange?.(changedValue, { e });\n  };\n\n  const onInternalClick: React.MouseEventHandler<HTMLButtonElement> = (e) => {\n    if (disabled) {\n      return;\n    }\n\n    if (!beforeChange) {\n      handleChange(e);\n      return;\n    }\n    Promise.resolve(beforeChange())\n      .then((v) => {\n        if (v) {\n          handleChange(e);\n        }\n      })\n      .catch((e) => {\n        console.error('Switch', `some error occurred: ${e}`);\n      });\n  };\n\n  useEffect(() => {\n    if (Array.isArray(customValue) && !customValue.includes(value)) {\n      console.error('Switch', `value is not in customValue: ${JSON.stringify(customValue)}`);\n    }\n    isControlled && setInnerChecked(value === activeValue);\n  }, [value, customValue, activeValue, isControlled]);\n\n  const { SIZE, STATUS } = useCommonClassName();\n  const switchClassName = classNames(\n    `${classPrefix}-switch`,\n    className,\n    {\n      [STATUS.checked]: innerChecked,\n      [STATUS.disabled]: disabled,\n      [STATUS.loading]: loading,\n    },\n    SIZE[size],\n  );\n\n  return (\n    <button\n      {...restProps}\n      type=\"button\"\n      role=\"switch\"\n      disabled={disabled || loading}\n      className={switchClassName}\n      ref={ref}\n      onClick={onInternalClick}\n    >\n      <span className={`${classPrefix}-switch__handle`}>{loading && <Loading loading size=\"small\" />}</span>\n      <div className={`${classPrefix}-switch__content`}>{contentNode}</div>\n    </button>\n  );\n});\n\nSwitch.displayName = 'Switch';\n\nexport default Switch as <T extends SwitchValue = SwitchValue>(\n  props: SwitchProps<T> & React.RefAttributes<HTMLButtonElement>,\n) => React.ReactElement;\n"],"names":["switchDefaultProps","label","loading","size","Switch","React","forwardRef","originalProps","ref","_useConfig","useConfig","classPrefix","props","useDefaultProps","className","value","defaultValue","disabled","customValue","onChange","beforeChange","restProps","_objectWithoutProperties","_excluded","_ref","_ref2","_slicedToArray","_ref2$","activeValue","_ref2$2","inactiveValue","isControlled","initChecked","_useState","useState","_useState2","innerChecked","setInnerChecked","contentNode","useMemo","Array","isArray","_label","_label$","activeContent","_label$2","inactiveContent","content","parseTNode","handleChange","e","changedValue","onInternalClick","Promise","resolve","then","v","console","error","concat","useEffect","includes","JSON","stringify","_useCommonClassName","useCommonClassName","SIZE","STATUS","switchClassName","classNames","_defineProperty","checked","createElement","_objectSpread","type","role","onClick","Loading","displayName"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAGO,IAAMA,kBAAA,GAAoC;AAAEC,EAAAA,KAAA,EAAO;AAAIC,EAAAA,OAAA,EAAS,KAAA;AAAOC,EAAAA,MAAM;AAAS,CAAA;;;;;ACa7F,IAAMC,MAAA,gBAASC,KAAA,CAAMC,UAAA,CAA2C,UAACC,eAAeC,GAAA,EAAQ;AACtF,EAAA,IAAAC,UAAA,GAAwBC,SAAA,EAAU;IAA1BC,WAAA,GAAAF,UAAA,CAAAE,WAAA;AACR,EAAA,IAAMC,KAAA,GAAQC,eAAA,CAA0CN,aAAA,EAAeP,kBAAkB,CAAA;AACzF,EAAA,IACEc,SAAA,GAWEF,KAAA,CAXFE,SAAA;IACAC,KAAA,GAUEH,KAAA,CAVFG,KAAA;IACAC,YAAA,GASEJ,KAAA,CATFI,YAAA;IACAC,QAAA,GAQEL,KAAA,CARFK,QAAA;IACAf,OAAA,GAOEU,KAAA,CAPFV,OAAA;IACAC,IAAA,GAMES,KAAA,CANFT,IAAA;IACAF,KAAA,GAKEW,KAAA,CALFX,KAAA;IACAiB,WAAA,GAIEN,KAAA,CAJFM,WAAA;IACAC,QAAA,GAGEP,KAAA,CAHFO,QAAA;IACAC,YAAA,GAEER,KAAA,CAFFQ,YAAA;AACGC,IAAAA,SAAA,GAAAC,wBAAA,CACDV,KAAA,EAAAW,SAAA,CAAA;AACJ,EAAA,IAAAC,IAAA,GAAoDN,eAAe,EAAC;IAAAO,KAAA,GAAAC,cAAA,CAAAF,IAAA,EAAA,CAAA,CAAA;AAAAG,IAAAA,MAAA,GAAAF,KAAA,CAAA,CAAA,CAAA;AAA7DG,IAAAA,WAAA,GAAAD,MAAA,KAAA,KAAA,CAAA,GAAc,IAAA,GAAAA,MAAA;AAAAE,IAAAA,OAAA,GAAAJ,KAAA,CAAA,CAAA,CAAA;AAAMK,IAAAA,qCAAgB,KAAK,GAAAD,OAAA;AAEhD,EAAA,IAAME,YAAA,GAAe,OAAOhB,KAAA,KAAU,WAAA;EACtC,IAAMiB,WAAA,GAAchB,YAAA,KAAiBY,WAAA,IAAeb,KAAA,KAAUa,WAAA;AAC9D,EAAA,IAAAK,SAAA,GAAwCC,sBAASF,WAAW,CAAA;IAAAG,UAAA,GAAAT,cAAA,CAAAO,SAAA,EAAA,CAAA,CAAA;AAArDG,IAAAA,YAAA,GAAAD,UAAA,CAAA,CAAA,CAAA;AAAcE,IAAAA,eAAe,GAAAF,UAAA,CAAA,CAAA,CAAA;AAEpC,EAAA,IAAMG,WAAA,GAAcjC,KAAA,CAAMkC,OAAA,CAAyB,YAAM;AACvD,IAAA,IAAIC,KAAA,CAAMC,OAAA,CAAQxC,KAAK,CAAA,EAAG;AACxB,MAAA,IAAAyC,MAAA,GAAAhB,cAAA,CAAmDzB,KAAA,EAAA,CAAA,CAAA;AAAA0C,QAAAA,OAAA,GAAAD,MAAA,CAAA,CAAA,CAAA;AAA5CE,QAAAA,aAAA,GAAAD,OAAA,KAAA,KAAA,CAAA,GAAgB,EAAA,GAAAA,OAAA;AAAAE,QAAAA,QAAA,GAAAH,MAAA,CAAA,CAAA,CAAA;AAAII,QAAAA,eAAA,GAAAD,QAAA,KAAA,KAAA,CAAA,GAAkB,EAAE,GAAAA,QAAA;AAC/C,MAAA,IAAME,OAAA,GAAUX,eAAeQ,aAAA,GAAgBE,eAAA;MAC/C,OAAOE,UAAA,CAAWD,OAAA,EAAS;AAAEhC,QAAAA,KAAA,EAAAA;AAAM,OAAC,CAAA;AACtC,IAAA;IACA,OAAOiC,UAAA,CAAW/C,KAAA,EAAO;AAAEc,MAAAA,KAAA,EAAAA;AAAM,KAAC,CAAA;EACpC,CAAA,EAAG,CAACd,KAAA,EAAOmC,YAAA,EAAcrB,KAAK,CAAC,CAAA;AAE/B,EAAA,IAAMkC,YAAA,GAAe,SAAfA,YAAAA,CAAgBC,CAAA,EAAwB;AAC5C,IAAA,CAACnB,YAAA,IAAgBM,eAAA,CAAgB,CAACD,YAAY,CAAA;AAC9C,IAAA,IAAMe,YAAA,GAAe,CAACf,YAAA,GAAeR,WAAA,GAAcE,aAAA;AACnDX,IAAAA,QAAA,aAAAA,QAAA,KAAA,KAAA,CAAA,IAAAA,QAAA,CAAWgC,YAAA,EAAc;AAAED,MAAAA,CAAA,EAAAA;AAAE,KAAC,CAAA;EAChC,CAAA;AAEA,EAAA,IAAME,eAAA,GAA8D,SAA9DA,eAAAA,CAA+DF,CAAA,EAAM;AACzE,IAAA,IAAIjC,QAAA,EAAU;AACZ,MAAA;AACF,IAAA;IAEA,IAAI,CAACG,YAAA,EAAc;MACjB6B,YAAA,CAAaC,CAAC,CAAA;AACd,MAAA;AACF,IAAA;AACAG,IAAAA,OAAA,CAAQC,QAAQlC,YAAA,EAAc,CAAA,CAC3BmC,IAAA,CAAK,UAACC,CAAA,EAAM;AACX,MAAA,IAAIA,CAAA,EAAG;QACLP,YAAA,CAAaC,CAAC,CAAA;AAChB,MAAA;AACF,IAAA,CAAC,CAAA,CAAA,OAAA,CACA,CAAM,UAACA,EAAAA,EAAM;MACZO,OAAA,CAAQC,KAAA,CAAM,QAAA,0BAAAC,MAAA,CAAkCT,EAAC,CAAE,CAAA;AACrD,IAAA,CAAC,CAAA;EACL,CAAA;AAEAU,EAAAA,sBAAA,CAAU,YAAM;AACd,IAAA,IAAIpB,KAAA,CAAMC,QAAQvB,WAAW,CAAA,IAAK,CAACA,WAAA,CAAY2C,QAAA,CAAS9C,KAAK,CAAA,EAAG;AAC9D0C,MAAAA,OAAA,CAAQC,MAAM,QAAA,kCAAAC,MAAA,CAA0CG,KAAKC,SAAA,CAAU7C,WAAW,CAAC,CAAE,CAAA;AACvF,IAAA;AACAa,IAAAA,YAAA,IAAgBM,eAAA,CAAgBtB,UAAUa,WAAW,CAAA;EACvD,GAAG,CAACb,KAAA,EAAOG,WAAA,EAAaU,WAAA,EAAaG,YAAY,CAAC,CAAA;AAElD,EAAA,IAAAiC,mBAAA,GAAyBC,kBAAA,EAAmB;IAApCC,IAAA,GAAAF,mBAAA,CAAAE,IAAA;IAAMC,MAAA,GAAAH,mBAAA,CAAAG,MAAA;AACd,EAAA,IAAMC,eAAA,GAAkBC,UAAA,CAAA,EAAA,CAAAV,MAAA,CACnBhD,WAAW,EAAA,SAAA,CAAA,EACdG,SAAA,EAAAwD,eAAA,CAAAA,eAAA,CAAAA,eAAA,CAAA,EAAA,EAEGH,MAAA,CAAOI,OAAO,EAAGnC,YAAA,GACjB+B,MAAA,CAAOlD,QAAQ,EAAGA,QAAA,CAAA,EAClBkD,MAAA,CAAOjE,OAAO,EAAGA,OAAA,CAAA,EAEpBgE,KAAK/D,IAAI,CACX,CAAA;EAEA,sBACEE,KAAA,CAAAmE,aAAA,CAAC,QAAA,EAAAC,aAAA,CAAAA,aAAA,CAAA,EAAA,EACKpD,SAAA,CAAA,EAAA,EAAA,EAAA;AACJqD,IAAAA,IAAA,EAAK,QAAA;AACLC,IAAAA,IAAA,EAAK,QAAA;IACL1D,UAAUA,QAAA,IAAYf,OAAA;AACtBY,IAAAA,SAAA,EAAWsD,eAAA;AACX5D,IAAAA,GAAA,EAAAA,GAAA;AACAoE,IAAAA,OAAA,EAASxB;AAAA,GAAA,CAAA,iBAET/C,KAAA,CAAAmE,aAAA,CAAC,MAAA,EAAA;IAAK1D,SAAA,EAAA,EAAA,CAAA6C,MAAA,CAAchD,WAAW,EAAA,iBAAA;GAAA,EAAoBT,OAAA,mBAAWG,KAAA,CAAAmE,aAAA,CAACK,OAAA,EAAA;AAAQ3E,IAAAA,OAAA,EAAO,IAAA;AAACC,IAAAA,IAAA,EAAK;GAAQ,CAAG,CAAA,qCAC9F,KAAA,EAAA;IAAIW,SAAA,EAAA,EAAA,CAAA6C,MAAA,CAAchD,WAAW,EAAA,kBAAA;KAAqB2B,WAAY,CACjE,CAAA;AAEJ,CAAC;AAEDlC,MAAA,CAAO0E,WAAA,GAAc,QAAA;;;;"}