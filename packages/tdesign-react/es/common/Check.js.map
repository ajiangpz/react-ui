{"version":3,"file":"Check.js","sources":["../../../components/common/Check.tsx"],"sourcesContent":["import React, { forwardRef, useContext, MouseEvent, ChangeEvent } from 'react';\nimport classNames from 'classnames';\nimport { isBoolean } from 'lodash-es';\nimport { omit } from '../utils/helper';\nimport { StyledProps } from '../common';\nimport useConfig from '../hooks/useConfig';\nimport useControlled from '../hooks/useControlled';\nimport { TdCheckboxProps } from '../checkbox/type';\n\nexport interface CheckProps extends TdCheckboxProps, StyledProps {\n    type: 'radio' | 'radio-button' | 'checkbox';\n    allowUncheck?: boolean;\n    title?: string;\n    children?: React.ReactNode;\n    stopLabelTrigger?: Boolean;\n}\n\n/**\n * Check 组件支持使用 CheckContext 进行状态托管\n */\nexport const CheckContext = React.createContext<CheckContextValue>(null);\n\n/**\n * 托管 Check 组件的状态，请提供 inject() 方法注入托管好的 props\n */\nexport interface CheckContextValue {\n    inject: (props: CheckProps) => CheckProps;\n}\n\nconst Check = forwardRef<HTMLLabelElement, CheckProps>((_props, ref) => {\n    // 支持从 Context 注入\n    const context = useContext(CheckContext);\n    const props = context ? context.inject(_props) : _props;\n\n    const {\n        allowUncheck = false,\n        type,\n        disabled,\n        name,\n        value,\n        onChange,\n        indeterminate,\n        children,\n        label,\n        className,\n        style,\n        readonly,\n        onClick,\n        ...htmlProps\n    } = props;\n\n    const { classPrefix } = useConfig();\n\n    const TOnChange: (\n        checked: boolean,\n        context: { e: ChangeEvent<HTMLInputElement> | MouseEvent<HTMLInputElement> },\n    ) => void = onChange;\n\n    const [internalChecked, setInternalChecked] = useControlled(props, 'checked', TOnChange);\n\n    const labelClassName = classNames(`${classPrefix}-${type}`, className, {\n        [`${classPrefix}-is-checked`]: internalChecked,\n        [`${classPrefix}-is-disabled`]: disabled,\n        [`${classPrefix}-is-indeterminate`]: indeterminate,\n    });\n\n    const isDisabled = disabled || readonly;\n\n    const input = (\n        <input\n            readOnly={readonly}\n            type={type === 'radio-button' ? 'radio' : type}\n            className={`${classPrefix}-${type}__former`}\n            checked={internalChecked}\n            disabled={disabled}\n            name={name}\n            tabIndex={-1}\n            value={isBoolean(value) ? Number(value) : value}\n            data-value={typeof value === 'string' ? `'${value}'` : value}\n            data-allow-uncheck={allowUncheck || undefined}\n            onClick={(e) => {\n                e.stopPropagation();\n                if ((type === 'radio-button' || type === 'radio') && allowUncheck && internalChecked) {\n                    setInternalChecked(!e.currentTarget.checked, { e });\n                }\n            }}\n            onChange={(e) => {\n                if (isDisabled) return;\n                setInternalChecked(e.currentTarget.checked, { e });\n            }}\n        />\n    );\n    // Checkbox/ Radio 内容为空则不再渲染 span，不存在 0:Number 的情况\n    const showLabel = !!(children || label);\n\n    const handleLabelClick = (event: MouseEvent<HTMLSpanElement>) => {\n        // 在tree等组件中使用  阻止label触发checked 与expand冲突\n        if (props.stopLabelTrigger) {\n            event.preventDefault();\n        }\n    };\n\n    const onInnerClick = (e: MouseEvent<HTMLLabelElement>) => {\n        if (isDisabled) return;\n        onClick?.({ e });\n    };\n\n    return (\n        <label\n            ref={ref}\n            tabIndex={disabled ? undefined : 0}\n            className={labelClassName}\n            title={props.title}\n            style={style}\n            {...omit(htmlProps, ['checkAll', 'stopLabelTrigger'])}\n            onClick={onInnerClick}\n        >\n            {input}\n            <span className={`${classPrefix}-${type}__input`} />\n            {showLabel && (\n                <span key=\"label\" className={`${classPrefix}-${type}__label`} onClick={handleLabelClick}>\n                    {children || label}\n                </span>\n            )}\n        </label>\n    );\n});\n\nCheck.displayName = 'Check';\n\nexport default Check;\n"],"names":["CheckContext","React","createContext","Check","forwardRef","_props","ref","context","useContext","props","inject","_props$allowUncheck","allowUncheck","type","disabled","name","value","onChange","indeterminate","children","label","className","style","readonly","onClick","htmlProps","_objectWithoutProperties","_excluded","_useConfig","useConfig","classPrefix","TOnChange","_useControlled","useControlled","_useControlled2","_slicedToArray","internalChecked","setInternalChecked","labelClassName","classNames","concat","_defineProperty","isDisabled","input","createElement","readOnly","checked","tabIndex","isBoolean","Number","e","stopPropagation","currentTarget","showLabel","handleLabelClick","event","stopLabelTrigger","preventDefault","onInnerClick","_objectSpread","title","omit","key","displayName"],"mappings":"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"}