{"version":3,"file":"Portal.js","sources":["../../../components/common/Portal.tsx"],"sourcesContent":["import React, { forwardRef, useMemo, useImperativeHandle } from 'react';\nimport { createPortal } from 'react-dom';\nimport { AttachNode, AttachNodeReturnValue } from '../common';\nimport { canUseDocument } from '../utils/dom';\nimport useConfig from '../hooks/useConfig';\nimport useIsomorphicLayoutEffect from '../hooks/useLayoutEffect';\n\nexport interface PortalProps {\n  /**\n   * 指定挂载的 HTML 节点, false 为挂载在 body\n   */\n  attach?: React.ReactElement | AttachNode | boolean;\n  /**\n   * 触发元素\n   */\n  triggerNode?: HTMLElement;\n  children: React.ReactNode;\n}\n\nexport function getAttach(\n  attach: PortalProps['attach'],\n  triggerNode?: HTMLElement,\n): AttachNodeReturnValue {\n  if (!canUseDocument) return null;\n\n  let el: AttachNodeReturnValue;\n  if (typeof attach === 'string') {\n    el = document.querySelector(attach);\n  }\n  if (typeof attach === 'function') {\n    el = attach(triggerNode);\n  }\n  if (typeof attach === 'object' && attach instanceof window.HTMLElement) {\n    el = attach;\n  }\n\n  // fix el in iframe\n  if (el && el.nodeType === 1) return el;\n\n  return document.body;\n}\n\nconst Portal = forwardRef((props: PortalProps, ref) => {\n  const { attach, children, triggerNode } = props;\n  const { classPrefix } = useConfig();\n\n  const container = useMemo(() => {\n    if (!canUseDocument) return null;\n    const el = document.createElement('div');\n    el.className = `${classPrefix}-portal-wrapper`;\n    return el;\n  }, [classPrefix]);\n\n  useIsomorphicLayoutEffect(() => {\n    const parentElement = getAttach(attach, triggerNode);\n    parentElement?.appendChild?.(container);\n\n    return () => {\n      parentElement?.removeChild?.(container);\n    };\n  }, [container, attach, triggerNode]);\n\n  useImperativeHandle(ref, () => container);\n\n  return canUseDocument ? createPortal(children, container) : null;\n});\n\nPortal.displayName = 'Portal';\n\nexport default Portal;\n"],"names":["getAttach","attach","triggerNode","canUseDocument","el","document","querySelector","_typeof","window","HTMLElement","nodeType","body","Portal","forwardRef","props","ref","children","_useConfig","useConfig","classPrefix","container","useMemo","createElement","className","concat","useIsomorphicLayoutEffect","_parentElement$append","parentElement","appendChild","call","_parentElement$remove","removeChild","useImperativeHandle","createPortal","displayName"],"mappings":";;;;;;;;AAmBO,SAASA,SAAAA,CACdC,QACAC,WAAA,EACuB;AACvB,EAAA,IAAI,CAACC,gBAAgB,OAAO,IAAA;AAE5B,EAAA,IAAIC,EAAA;AACJ,EAAA,IAAI,OAAOH,WAAW,QAAA,EAAU;AAC9BG,IAAAA,EAAA,GAAKC,QAAA,CAASC,cAAcL,MAAM,CAAA;AACpC,EAAA;AACA,EAAA,IAAI,OAAOA,WAAW,UAAA,EAAY;AAChCG,IAAAA,EAAA,GAAKH,OAAOC,WAAW,CAAA;AACzB,EAAA;EACA,IAAIK,OAAA,CAAON,MAAA,CAAA,KAAW,QAAA,IAAYA,MAAA,YAAkBO,OAAOC,WAAA,EAAa;AACtEL,IAAAA,EAAA,GAAKH,MAAA;AACP,EAAA;EAGA,IAAIG,EAAA,IAAMA,EAAA,CAAGM,QAAA,KAAa,CAAA,EAAG,OAAON,EAAA;EAEpC,OAAOC,QAAA,CAASM,IAAA;AAClB;AAEA,IAAMC,MAAA,gBAASC,uBAAA,CAAW,UAACC,KAAA,EAAoBC,GAAA,EAAQ;AACrD,EAAA,IAAQd,MAAA,GAAkCa,KAAA,CAAlCb,MAAA;IAAQe,QAAA,GAA0BF,KAAA,CAA1BE,QAAA;IAAUd,WAAA,GAAgBY,KAAA,CAAhBZ,WAAA;AAC1B,EAAA,IAAAe,UAAA,GAAwBC,SAAA,EAAU;IAA1BC,WAAA,GAAAF,UAAA,CAAAE,WAAA;AAER,EAAA,IAAMC,SAAA,GAAYC,qBAAQ,YAAM;AAC9B,IAAA,IAAI,CAAClB,gBAAgB,OAAO,IAAA;AAC5B,IAAA,IAAMC,EAAA,GAAKC,QAAA,CAASiB,aAAA,CAAc,KAAK,CAAA;AACvClB,IAAAA,EAAA,CAAGmB,SAAA,GAAA,EAAA,CAAAC,MAAA,CAAeL,WAAW,EAAA,iBAAA,CAAA;AAC7B,IAAA,OAAOf,EAAA;AACT,EAAA,CAAA,EAAG,CAACe,WAAW,CAAC,CAAA;AAEhBM,EAAAA,yBAAA,CAA0B,YAAM;AAAA,IAAA,IAAAC,qBAAA;AAC9B,IAAA,IAAMC,aAAA,GAAgB3B,SAAA,CAAUC,MAAA,EAAQC,WAAW,CAAA;AACnDyB,IAAAA,aAAA,aAAAA,aAAA,KAAA,KAAA,CAAA,IAAA,CAAAD,qBAAA,GAAAC,aAAA,CAAeC,6DAAfF,qBAAA,CAAAG,IAAA,CAAAF,aAAA,EAA6BP,SAAS,CAAA;AAEtC,IAAA,OAAO,YAAM;AAAA,MAAA,IAAAU,qBAAA;AACXH,MAAAA,aAAA,aAAAA,aAAA,KAAA,KAAA,CAAA,IAAA,CAAAG,qBAAA,GAAAH,aAAA,CAAeI,6DAAfD,qBAAA,CAAAD,IAAA,CAAAF,aAAA,EAA6BP,SAAS,CAAA;IACxC,CAAA;EACF,CAAA,EAAG,CAACA,SAAA,EAAWnB,MAAA,EAAQC,WAAW,CAAC,CAAA;EAEnC8B,gCAAA,CAAoBjB,GAAA,EAAK,YAAA;AAAA,IAAA,OAAMK,SAAS;EAAA,CAAA,CAAA;EAExC,OAAOjB,cAAA,gBAAiB8B,4BAAA,CAAajB,QAAA,EAAUI,SAAS,CAAA,GAAI,IAAA;AAC9D,CAAC;AAEDR,MAAA,CAAOsB,WAAA,GAAc,QAAA;;;;"}