{"version":3,"file":"useMultiple.js","sources":["../../../../components/select-input/hook/useMultiple.tsx"],"sourcesContent":["import React, { useRef, MouseEvent } from 'react';\nimport { isObject } from 'lodash-es';\nimport classNames from 'classnames';\nimport { TdSelectInputProps, SelectInputChangeContext, SelectInputKeys, SelectInputValue } from '../type';\nimport TagInput, { TagInputValue } from '../../tag-input';\nimport { SelectInputCommonProperties } from '../interface';\nimport useControlled from '../../hooks/useControlled';\nimport useConfig from '../../hooks/useConfig';\nimport { InputRef } from '../../input';\nimport { StyledProps } from '../../common';\n\nexport interface RenderSelectMultipleParams {\n    commonInputProps: SelectInputCommonProperties;\n    onInnerClear: (context: { e: MouseEvent<SVGElement> }) => void;\n    popupVisible: boolean;\n    allowInput: boolean;\n}\n\nconst DEFAULT_KEYS = {\n    label: 'label',\n    key: 'key',\n    children: 'children',\n};\n\nexport interface SelectInputProps extends TdSelectInputProps, StyledProps {\n    options?: any[]; // 参数穿透options, 给SelectInput/SelectInput 自定义选中项呈现的内容和多选状态下设置折叠项内容\n}\n\nexport default function useMultiple(props: SelectInputProps) {\n    const { value } = props;\n    const { classPrefix } = useConfig();\n    const tagInputRef = useRef<InputRef>(null);\n    const [tInputValue, setTInputValue] = useControlled(props, 'inputValue', props.onInputChange);\n    const iKeys: SelectInputKeys = { ...DEFAULT_KEYS, ...props.keys };\n\n    const getTags = () => {\n        if (!(value instanceof Array)) {\n            if (['', null, undefined].includes(value as any)) return [];\n            return isObject(value) ? [value[iKeys.label]] : [value];\n        }\n        return value.map((item: SelectInputValue) => (isObject(item) ? item[iKeys.label] : item));\n    };\n    const tags = getTags();\n    const tPlaceholder = !tags || !tags.length ? props.placeholder : '';\n\n    const onTagInputChange = (val: TagInputValue, context: SelectInputChangeContext) => {\n        // 避免触发浮层的显示或隐藏\n        if (context.trigger === 'tag-remove') {\n            context.e?.stopPropagation();\n        }\n        props.onTagChange?.(val, context);\n    };\n\n    const renderSelectMultiple = (p: RenderSelectMultipleParams) => (\n        <TagInput\n            ref={tagInputRef}\n            {...p.commonInputProps}\n            autoWidth={props.autoWidth}\n            readonly={props.readonly}\n            minCollapsedNum={props.minCollapsedNum}\n            collapsedItems={props.collapsedItems}\n            tag={props.tag}\n            valueDisplay={props.valueDisplay}\n            placeholder={tPlaceholder}\n            options={props.options}\n            value={tags}\n            inputValue={p.popupVisible && p.allowInput ? tInputValue : ''}\n            onChange={onTagInputChange}\n            onInputChange={(val, context) => {\n                // 筛选器统一特性：筛选器按下回车时不清空输入框\n                if (context?.trigger === 'enter' || context?.trigger === 'blur') return;\n                setTInputValue(val, { trigger: context.trigger, e: context.e });\n            }}\n            tagProps={props.tagProps}\n            onClear={p.onInnerClear}\n            // [Important Info]: SelectInput.blur is not equal to TagInput, example: click popup panel\n            onFocus={(val, context) => {\n                props.onFocus?.(props.value, { ...context, tagInputValue: val });\n            }}\n            onBlur={!props.panel ? props.onBlur : null}\n            {...props.tagInputProps}\n            inputProps={{\n                ...props.inputProps,\n                readonly: !props.allowInput || props.readonly,\n                inputClass: classNames(props.tagInputProps?.className, {\n                    [`${classPrefix}-input--focused`]: p.popupVisible,\n                    [`${classPrefix}-is-focused`]: p.popupVisible,\n                }),\n            }}\n        />\n    );\n\n    return {\n        tags,\n        tPlaceholder,\n        tagInputRef,\n        multipleInputValue: tInputValue,\n        renderSelectMultiple,\n    };\n}\n"],"names":["DEFAULT_KEYS","label","key","children","useMultiple","props","value","_useConfig","useConfig","classPrefix","tagInputRef","useRef","_useControlled","useControlled","onInputChange","_useControlled2","_slicedToArray","tInputValue","setTInputValue","iKeys","keys","getTags","Array","includes","isObject","map","item","tags","tPlaceholder","length","placeholder","onTagInputChange","val","context","_props$onTagChange","trigger","_context$e","e","stopPropagation","onTagChange","call","renderSelectMultiple","p","_props$tagInputProps","React","createElement","TagInput","_objectSpread","ref","commonInputProps","autoWidth","readonly","minCollapsedNum","collapsedItems","tag","valueDisplay","options","inputValue","popupVisible","allowInput","onChange","tagProps","onClear","onInnerClear","onFocus","_props$onFocus","tagInputValue","onBlur","panel","tagInputProps","inputProps","inputClass","classNames","className","_defineProperty","concat","multipleInputValue"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkBA,IAAMA,YAAA,GAAe;AACjBC,EAAAA,KAAA,EAAO,OAAA;AACPC,EAAAA,GAAA,EAAK,KAAA;AACLC,EAAAA,QAAA,EAAU;AACd,CAAA;AAMA,SAAwBC,YAAYC,KAAA,EAAyB;AACzD,EAAA,IAAQC,QAAUD,KAAA,CAAVC;AACR,EAAA,IAAAC,UAAA,GAAwBC,SAAA,EAAU;IAA1BC,WAAA,GAAAF,UAAA,CAAAE,WAAA;AACR,EAAA,IAAMC,WAAA,GAAcC,oBAAiB,IAAI,CAAA;EACzC,IAAAC,cAAA,GAAsCC,cAAcR,KAAA,EAAO,YAAA,EAAcA,MAAMS,aAAa,CAAA;IAAAC,eAAA,GAAAC,cAAA,CAAAJ,cAAA,EAAA,CAAA,CAAA;AAArFK,IAAAA;AAAaC,IAAAA,cAAc,GAAAH,eAAA,CAAA,CAAA,CAAA;EAClC,IAAMI,wCAA8BnB,YAAA,CAAA,EAAiBK,MAAMe,IAAA,CAAK;AAEhE,EAAA,IAAMC,UAAU,SAAVA,UAAgB;AAClB,IAAA,IAAI,EAAEf,iBAAiBgB,KAAA,CAAA,EAAQ;AAC3B,MAAA,IAAI,CAAC,IAAI,IAAA,EAAM,KAAA,CAAS,EAAEC,QAAA,CAASjB,KAAY,CAAA,EAAG,OAAO,EAAC;AAC1D,MAAA,OAAOkB,QAAA,CAASlB,KAAK,CAAA,GAAI,CAACA,KAAA,CAAMa,MAAMlB,KAAK,CAAC,CAAA,GAAI,CAACK,KAAK,CAAA;AAC1D,IAAA;AACA,IAAA,OAAOA,KAAA,CAAMmB,GAAA,CAAI,UAACC,IAAA,EAAA;AAAA,MAAA,OAA4BF,QAAA,CAASE,IAAI,CAAA,GAAIA,IAAA,CAAKP,KAAA,CAAMlB,KAAK,CAAA,GAAIyB,IAAK;IAAA,CAAA,CAAA;EAC5F,CAAA;AACA,EAAA,IAAMC,OAAON,OAAA,EAAQ;AACrB,EAAA,IAAMO,eAAe,CAACD,IAAA,IAAQ,CAACA,IAAA,CAAKE,MAAA,GAASxB,MAAMyB,WAAA,GAAc,EAAA;EAEjE,IAAMC,gBAAA,GAAmB,SAAnBA,gBAAAA,CAAoBC,GAAA,EAAoBC,OAAA,EAAsC;AAAA,IAAA,IAAAC,kBAAA;AAEhF,IAAA,IAAID,OAAA,CAAQE,YAAY,YAAA,EAAc;AAAA,MAAA,IAAAC,UAAA;AAClC,MAAA,CAAAA,UAAA,GAAAH,OAAA,CAAQI,wCAARD,UAAA,CAAWE,eAAA,EAAgB;AAC/B,IAAA;AACA,IAAA,CAAAJ,kBAAA,GAAA7B,KAAA,CAAMkC,WAAA,cAAAL,kBAAA,KAAA,KAAA,CAAA,IAANA,kBAAA,CAAAM,IAAA,CAAAnC,KAAA,EAAoB2B,KAAKC,OAAO,CAAA;EACpC,CAAA;AAEA,EAAA,IAAMQ,oBAAA,GAAuB,SAAvBA,oBAAAA,CAAwBC,CAAA,EAAA;AAAA,IAAA,IAAAC,oBAAA;IAAA,sBAC1BC,KAAA,CAAAC,aAAA,CAACC,QAAA,EAAAC,aAAA,CAAAA,aAAA,CAAAA,aAAA,CAAA;AACGC,MAAAA,GAAA,EAAKtC;KAAA,EACDgC,CAAA,CAAEO,gBAAA,CAAA,EAAA,EAAA,EAAA;MACNC,WAAW7C,KAAA,CAAM6C,SAAA;MACjBC,UAAU9C,KAAA,CAAM8C,QAAA;MAChBC,iBAAiB/C,KAAA,CAAM+C,eAAA;MACvBC,gBAAgBhD,KAAA,CAAMgD,cAAA;MACtBC,KAAKjD,KAAA,CAAMiD,GAAA;MACXC,cAAclD,KAAA,CAAMkD,YAAA;AACpBzB,MAAAA,WAAA,EAAaF,YAAA;MACb4B,SAASnD,KAAA,CAAMmD,OAAA;AACflD,MAAAA,KAAA,EAAOqB,IAAA;MACP8B,UAAA,EAAYf,CAAA,CAAEgB,YAAA,IAAgBhB,CAAA,CAAEiB,aAAa1C,WAAA,GAAc,EAAA;AAC3D2C,MAAAA,QAAA,EAAU7B,gBAAA;AACVjB,MAAAA,aAAA,EAAe,SAAfA,aAAAA,CAAgBkB,GAAA,EAAKC,OAAA,EAAY;QAE7B,IAAI,CAAAA,OAAA,KAAA,IAAA,IAAAA,OAAA,uBAAAA,OAAA,CAASE,OAAA,MAAY,OAAA,IAAW,CAAAF,OAAA,aAAAA,OAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAAA,OAAA,CAASE,aAAY,MAAA,EAAQ;QACjEjB,cAAA,CAAec,GAAA,EAAK;UAAEG,OAAA,EAASF,OAAA,CAAQE;UAASE,CAAA,EAAGJ,OAAA,CAAQI;AAAE,SAAC,CAAA;MAClE,CAAA;MACAwB,UAAUxD,KAAA,CAAMwD,QAAA;MAChBC,SAASpB,CAAA,CAAEqB,YAAA;AAEXC,MAAAA,OAAA,EAAS,SAATA,OAAAA,CAAUhC,GAAA,EAAKC,OAAA,EAAY;AAAA,QAAA,IAAAgC,cAAA;QACvB,CAAAA,cAAA,GAAA5D,KAAA,CAAM2D,OAAA,MAAA,IAAA,IAAAC,cAAA,KAAA,KAAA,CAAA,IAANA,cAAA,CAAAzB,IAAA,CAAAnC,KAAA,EAAgBA,MAAMC,KAAA,EAAAyC,aAAA,CAAAA,aAAA,CAAA,EAAA,EAAYd,OAAA,CAAA,EAAA,EAAA,EAAA;AAASiC,UAAAA,aAAA,EAAelC;UAAK,CAAA;MACnE,CAAA;MACAmC,MAAA,EAAQ,CAAC9D,KAAA,CAAM+D,KAAA,GAAQ/D,MAAM8D,MAAA,GAAS;KAAA,EAClC9D,KAAA,CAAMgE,aAAA,CAAA,EAAA,EAAA,EAAA;AACVC,MAAAA,UAAA,EAAAvB,aAAA,CAAAA,aAAA,CAAA,EAAA,EACO1C,KAAA,CAAMiE,UAAA,CAAA,EAAA,EAAA,EAAA;QACTnB,QAAA,EAAU,CAAC9C,KAAA,CAAMsD,UAAA,IAActD,KAAA,CAAM8C,QAAA;AACrCoB,QAAAA,UAAA,EAAYC,UAAA,CAAA,CAAA7B,oBAAA,GAAWtC,KAAA,CAAMgE,aAAA,MAAA,IAAA,IAAA1B,oBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAANA,oBAAA,CAAqB8B,SAAA,EAAAC,eAAA,CAAAA,eAAA,CAAA,EAAA,EAAA,EAAA,CAAAC,MAAA,CACpClE,WAAW,EAAA,iBAAA,CAAA,EAAoBiC,CAAA,CAAEgB,YAAA,CAAA,EAAA,EAAA,CAAAiB,MAAA,CACjClE,WAAW,EAAA,aAAA,CAAA,EAAgBiC,CAAA,CAAEgB,YAAA,CACpC;AAAA,OAAA;AACL,KAAA,CACJ,CAAA;AAAA,EAAA,CAAA;EAGJ,OAAO;AACH/B,IAAAA,IAAA,EAAAA,IAAA;AACAC,IAAAA,YAAA,EAAAA,YAAA;AACAlB,IAAAA,WAAA,EAAAA,WAAA;AACAkE,IAAAA,kBAAA,EAAoB3D,WAAA;AACpBwB,IAAAA,oBAAA,EAAAA;GACJ;AACJ;;;;"}