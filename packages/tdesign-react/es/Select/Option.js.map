{"version":3,"file":"Option.js","sources":["../../../components/Select/Option.tsx"],"sourcesContent":["import React, { useEffect, useMemo } from 'react';\nimport classNames from 'classnames';\nimport { isNumber, isString, get } from 'lodash-es';\n\nimport useConfig from '../hooks/useConfig';\nimport useDomRefCallback from '../hooks/useDomRefCallback';\n\nimport { StyledProps } from '../common';\nimport {\n  SelectValue,\n  TdOptionProps,\n  TdSelectProps,\n  SelectKeysType,\n  SelectOption,\n} from './type';\n\nexport interface SelectOptionProps\n  extends StyledProps,\n  TdOptionProps,\n  Pick<TdSelectProps, 'size' | 'multiple' | 'max'> {\n  selectedValue?: SelectValue;\n  children?: React.ReactNode;\n  onSelect?: (\n    value: string | number,\n    context: {\n      label?: string;\n      selected?: boolean;\n      event: React.MouseEvent<HTMLLIElement>;\n      restData?: Record<string, any>;\n    },\n  ) => void;\n  onCheckAllChange?: (\n    checkAll: boolean,\n    e: React.MouseEvent<HTMLLIElement>,\n  ) => void;\n  restData?: Record<string, any>;\n  keys?: SelectKeysType;\n  optionLength?: number;\n  isVirtual?: boolean;\n  onRowMounted?: (rowData: { ref: HTMLElement; data: SelectOption }) => void;\n}\n\nconst componentType = 'select';\n\nconst Option: React.FC<SelectOptionProps> = (props) => {\n  const {\n    disabled: propDisabled,\n    label: propLabel,\n    title: propTitle,\n    selectedValue,\n    checkAll,\n    multiple,\n    size,\n    max,\n    keys,\n    value,\n    onSelect,\n    children,\n    content,\n    restData,\n    style,\n    className,\n    isVirtual,\n  } = props;\n  let selected: boolean;\n  let indeterminate: boolean;\n  const label = propLabel || value;\n  const disabled =\n    propDisabled ||\n    (multiple &&\n      Array.isArray(selectedValue) &&\n      max &&\n      selectedValue.length >= max);\n\n  const titleContent = useMemo(() => {\n    // 外部设置 props，说明希望受控\n    const controlledTitle = Reflect.has(props, 'title');\n    if (controlledTitle) return propTitle;\n    if (typeof label === 'string') return label;\n    return null;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [propTitle, label]);\n  const { classPrefix } = useConfig();\n  // 使用斜八角动画\n  const [optionRef, setRefCurrent] = useDomRefCallback();\n\n  useEffect(() => {\n    if (isVirtual && optionRef) {\n      props.onRowMounted?.({\n        ref: optionRef,\n        data: props,\n      });\n    }\n    // eslint-disable-next-line\n  }, [isVirtual, optionRef]);\n\n  // 处理单选场景\n  if (!multiple) {\n    selected =\n      isNumber(selectedValue) || isString(selectedValue)\n        ? value === selectedValue\n        : value === get(selectedValue, keys?.value || 'value');\n  }\n\n  // 处理多选场景\n  if (multiple && Array.isArray(selectedValue)) {\n    selected = selectedValue.some((item) => {\n      if (isNumber(item) || isString(item)) {\n        // 如果非 object 类型\n        return item === value;\n      }\n      return get(item, keys?.value || 'value') === value;\n    });\n    if (props.checkAll) {\n      selected = selectedValue.length === props.optionLength;\n      indeterminate = selectedValue.length > 0 && !selected;\n    }\n  }\n\n  const handleSelect = (event: React.MouseEvent<HTMLLIElement>) => {\n    if (!disabled && !checkAll) {\n      if (value)\n        onSelect?.(value, { label: String(label), selected, event, restData });\n    }\n    if (checkAll) {\n      props.onCheckAllChange?.(selected, event);\n    }\n  };\n\n  const renderItem = (children: React.ReactNode) => {\n    if (multiple) {\n      return (\n        <label\n          className={classNames(`${classPrefix}-checkbox`, {\n            [`${classPrefix}-is-indeterminate`]: indeterminate,\n            [`${classPrefix}-is-disabled`]: disabled,\n            [`${classPrefix}-is-checked`]: selected,\n          })}\n          title={titleContent}\n        >\n          <input\n            type=\"checkbox\"\n            className={classNames(`${classPrefix}-checkbox__former`)}\n            value=\"\"\n            disabled={disabled && !selected}\n            onClick={(e) => {\n              e.stopPropagation();\n              e.nativeEvent.stopImmediatePropagation();\n            }}\n          />\n          <span className={classNames(`${classPrefix}-checkbox__input`)}></span>\n          <span className={classNames(`${classPrefix}-checkbox__label`)}>\n            {children || content || label}\n          </span>\n        </label>\n      );\n    }\n    return <span title={titleContent}>{children || content || label}</span>;\n  };\n\n  return (\n    <li\n      className={classNames(\n        className,\n        `${classPrefix}-${componentType}-option`,\n        {\n          [`${classPrefix}-is-disabled`]: disabled,\n          [`${classPrefix}-is-selected`]: selected,\n          [`${classPrefix}-size-s`]: size === 'small',\n          [`${classPrefix}-size-l`]: size === 'large',\n        },\n      )}\n      key={value}\n      onClick={handleSelect}\n      ref={setRefCurrent}\n      style={style}\n    >\n      {renderItem(children)}\n    </li>\n  );\n};\n\nexport default Option;\n"],"names":["componentType","Option","props","propDisabled","disabled","propLabel","label","propTitle","title","selectedValue","checkAll","multiple","size","max","keys","value","onSelect","children","content","restData","style","className","isVirtual","selected","indeterminate","Array","isArray","length","titleContent","useMemo","controlledTitle","Reflect","has","_useConfig","useConfig","classPrefix","_useDomRefCallback","useDomRefCallback","_useDomRefCallback2","_slicedToArray","optionRef","setRefCurrent","useEffect","_props$onRowMounted","onRowMounted","call","ref","data","isNumber","isString","get","some","item","optionLength","handleSelect","event","String","_props$onCheckAllChan","onCheckAllChange","renderItem","React","createElement","classNames","concat","_defineProperty","type","onClick","e","stopPropagation","nativeEvent","stopImmediatePropagation","key"],"mappings":"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"}