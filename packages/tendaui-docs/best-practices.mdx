import { Meta } from "@storybook/blocks";

<Meta title="æ–‡æ¡£/æœ€ä½³å®è·µ" />

# æœ€ä½³å®è·µ

æœ¬æ–‡æ¡£æ€»ç»“äº†ä½¿ç”¨ TendaUI çš„æœ€ä½³å®è·µå’Œå¸¸è§æ¨¡å¼ã€‚

## ğŸ“¦ é¡¹ç›®ç»“æ„

### æ¨èçš„ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ components/          # ä¸šåŠ¡ç»„ä»¶
â”‚   â”œâ”€â”€ Header/
â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â””â”€â”€ Header.module.scss
â”‚   â””â”€â”€ Footer/
â”œâ”€â”€ pages/              # é¡µé¢ç»„ä»¶
â”‚   â”œâ”€â”€ Home/
â”‚   â””â”€â”€ About/
â”œâ”€â”€ hooks/              # è‡ªå®šä¹‰ Hooks
â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â”œâ”€â”€ services/           # API æœåŠ¡
â”œâ”€â”€ store/              # çŠ¶æ€ç®¡ç†
â”œâ”€â”€ styles/             # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ variables.scss  # å˜é‡
â”‚   â”œâ”€â”€ mixins.scss     # Mixins
â”‚   â””â”€â”€ global.scss     # å…¨å±€æ ·å¼
â”œâ”€â”€ App.tsx
â””â”€â”€ main.tsx
```

## ğŸ¨ ä¸»é¢˜å®šåˆ¶

### ä½¿ç”¨ CSS å˜é‡

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸»é¢˜æ–‡ä»¶ï¼š

```css
/* styles/theme.css */
:root {
  /* ä¸»è‰²è°ƒ */
  --td-brand-color: #1890ff;
  --td-brand-color-hover: #40a9ff;
  --td-brand-color-active: #096dd9;

  /* åŠŸèƒ½è‰² */
  --td-success-color: #52c41a;
  --td-warning-color: #faad14;
  --td-error-color: #ff4d4f;

  /* å°ºå¯¸ */
  --td-font-size-base: 14px;
  --td-spacing-base: 16px;
  --td-border-radius-default: 4px;
}

/* æš—è‰²ä¸»é¢˜ */
[data-theme="dark"] {
  --td-text-color-primary: rgba(255, 255, 255, 0.9);
  --td-text-color-secondary: rgba(255, 255, 255, 0.6);
  --td-bg-color-container: #1f1f1f;
  --td-bg-color-page: #141414;
  --td-border-color: #434343;
}
```

### å®ç°ä¸»é¢˜åˆ‡æ¢

```tsx
import React, { useState, useEffect } from "react";
import { ConfigProvider, Button, Space } from "tendaui-react";

export default function App() {
  const [theme, setTheme] = useState<"light" | "dark">("light");

  useEffect(() => {
    document.documentElement.setAttribute("data-theme", theme);
  }, [theme]);

  const toggleTheme = () => {
    setTheme((prevTheme) => (prevTheme === "light" ? "dark" : "light"));
  };

  return (
    <ConfigProvider theme={{ mode: theme }}>
      <div className="app">
        <Space>
          <Button onClick={toggleTheme}>åˆ‡æ¢åˆ°{theme === "light" ? "æš—è‰²" : "äº®è‰²"}ä¸»é¢˜</Button>
        </Space>
        {/* ä½ çš„åº”ç”¨å†…å®¹ */}
      </div>
    </ConfigProvider>
  );
}
```

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–

### 1. æŒ‰éœ€å¼•å…¥

ä½¿ç”¨ ES Module çš„ tree-shaking ç‰¹æ€§ï¼š

```tsx
// âœ… æ¨èï¼šä»ä¸»åŒ…å¼•å…¥ï¼Œç°ä»£æ‰“åŒ…å·¥å…·ä¼šè‡ªåŠ¨ tree-shake
import { Button, Input, Form } from "tendaui-react";

// âœ… ä¹Ÿå¯ä»¥ï¼šæ˜ç¡®çš„è·¯å¾„å¼•å…¥
import Button from "tendaui-react/es/button";
import Input from "tendaui-react/es/input";

// âŒ ä¸æ¨èï¼šå¼•å…¥æ•´ä¸ªåŒ…
import * as TendaUI from "tendaui-react";
```

### 2. æ‡’åŠ è½½ç»„ä»¶

å¯¹äºå¤§å‹ç»„ä»¶æˆ–ä¸å¸¸ç”¨çš„ç»„ä»¶ï¼Œä½¿ç”¨æ‡’åŠ è½½ï¼š

```tsx
import React, { lazy, Suspense } from "react";
import { Loading } from "tendaui-react";

// æ‡’åŠ è½½ç»„ä»¶
const HeavyComponent = lazy(() => import("./HeavyComponent"));

function App() {
  return (
    <Suspense fallback={<Loading loading />}>
      <HeavyComponent />
    </Suspense>
  );
}
```

### 3. ä½¿ç”¨ useMemo å’Œ useCallback

å¯¹äºå¤æ‚çš„è®¡ç®—å’Œå›è°ƒå‡½æ•°ï¼Œä½¿ç”¨ React Hooks ä¼˜åŒ–ï¼š

```tsx
import React, { useMemo, useCallback } from "react";
import { Button, Table } from "tendaui-react";

function DataTable({ data }) {
  // ç¼“å­˜è®¡ç®—ç»“æœ
  const processedData = useMemo(() => {
    return data.map((item) => ({
      ...item,
      fullName: `${item.firstName} ${item.lastName}`
    }));
  }, [data]);

  // ç¼“å­˜å›è°ƒå‡½æ•°
  const handleClick = useCallback((record) => {
    console.log("Clicked:", record);
  }, []);

  return <Table data={processedData} onRowClick={handleClick} />;
}
```

### 4. è™šæ‹Ÿæ»šåŠ¨

å¯¹äºé•¿åˆ—è¡¨ï¼Œä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ï¼š

```tsx
import React from "react";
import { VirtualList } from "tendaui-react";

function LongList({ items }) {
  return (
    <VirtualList
      data={items}
      height={400}
      itemHeight={50}
      renderItem={(item, index) => <div key={index}>{item.name}</div>}
    />
  );
}
```

## ğŸ“ è¡¨å•å¤„ç†

### è¡¨å•æœ€ä½³å®è·µ

```tsx
import React from "react";
import { Form, FormItem, Input, Button, message } from "tendaui-react";

function LoginForm() {
  const [form] = Form.useForm();
  const [loading, setLoading] = React.useState(false);

  const handleSubmit = async (e) => {
    const { validateResult, fields } = e;

    if (validateResult !== true) {
      message.error("è¯·æ£€æŸ¥è¡¨å•å¡«å†™");
      return;
    }

    setLoading(true);
    try {
      const response = await loginAPI(fields);
      message.success("ç™»å½•æˆåŠŸ");
      // å¤„ç†ç™»å½•æˆåŠŸé€»è¾‘
    } catch (error) {
      message.error(error.message || "ç™»å½•å¤±è´¥");
    } finally {
      setLoading(false);
    }
  };

  return (
    <Form form={form} onSubmit={handleSubmit} labelWidth="80px">
      <FormItem
        label="ç”¨æˆ·å"
        name="username"
        rules={[
          { required: true, message: "è¯·è¾“å…¥ç”¨æˆ·å" },
          { min: 3, message: "ç”¨æˆ·åè‡³å°‘3ä¸ªå­—ç¬¦" }
        ]}
      >
        <Input placeholder="è¯·è¾“å…¥ç”¨æˆ·å" autoComplete="username" />
      </FormItem>

      <FormItem
        label="å¯†ç "
        name="password"
        rules={[
          { required: true, message: "è¯·è¾“å…¥å¯†ç " },
          { min: 6, message: "å¯†ç è‡³å°‘6ä¸ªå­—ç¬¦" }
        ]}
      >
        <Input type="password" placeholder="è¯·è¾“å…¥å¯†ç " autoComplete="current-password" />
      </FormItem>

      <FormItem>
        <Button type="submit" variant="base" theme="primary" loading={loading} block>
          ç™»å½•
        </Button>
      </FormItem>
    </Form>
  );
}
```

### è¡¨å•å­—æ®µè”åŠ¨

```tsx
import React from "react";
import { Form, FormItem, Select, Input, Option } from "tendaui-react";

function DynamicForm() {
  const [form] = Form.useForm();
  const [userType, setUserType] = React.useState("personal");

  return (
    <Form form={form}>
      <FormItem label="ç”¨æˆ·ç±»å‹" name="userType">
        <Select value={userType} onChange={(value) => setUserType(value)}>
          <Option value="personal">ä¸ªäººç”¨æˆ·</Option>
          <Option value="enterprise">ä¼ä¸šç”¨æˆ·</Option>
        </Select>
      </FormItem>

      {userType === "personal" ? (
        <FormItem label="å§“å" name="name">
          <Input placeholder="è¯·è¾“å…¥å§“å" />
        </FormItem>
      ) : (
        <>
          <FormItem label="ä¼ä¸šåç§°" name="companyName">
            <Input placeholder="è¯·è¾“å…¥ä¼ä¸šåç§°" />
          </FormItem>
          <FormItem label="ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç " name="creditCode">
            <Input placeholder="è¯·è¾“å…¥ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç " />
          </FormItem>
        </>
      )}
    </Form>
  );
}
```

## ğŸ” TypeScript æœ€ä½³å®è·µ

### å®šä¹‰ç»„ä»¶ Props ç±»å‹

```tsx
import React from "react";
import { Button, ButtonProps } from "tendaui-react";

// æ‰©å±•ç»„ä»¶ Props
interface CustomButtonProps extends ButtonProps {
  analyticsId?: string;
  onAnalyticsClick?: () => void;
}

const CustomButton: React.FC<CustomButtonProps> = ({ analyticsId, onAnalyticsClick, onClick, ...rest }) => {
  const handleClick = (e: React.MouseEvent<HTMLElement>) => {
    // è‡ªå®šä¹‰é€»è¾‘
    if (analyticsId && onAnalyticsClick) {
      onAnalyticsClick();
    }
    onClick?.(e);
  };

  return <Button onClick={handleClick} {...rest} />;
};
```

### ç±»å‹å®‰å…¨çš„è¡¨å•

```tsx
import React from "react";
import { Form, FormItem, Input, FormInstance } from "tendaui-react";

// å®šä¹‰è¡¨å•æ•°æ®ç±»å‹
interface LoginFormData {
  username: string;
  password: string;
  remember?: boolean;
}

function TypedForm() {
  const [form] = Form.useForm<LoginFormData>();

  const handleSubmit = (e) => {
    const { fields } = e;
    // fields ç°åœ¨æœ‰å®Œæ•´çš„ç±»å‹æç¤º
    console.log(fields.username, fields.password);
  };

  return (
    <Form<LoginFormData> form={form} onSubmit={handleSubmit}>
      <FormItem<LoginFormData> label="ç”¨æˆ·å" name="username">
        <Input />
      </FormItem>

      <FormItem<LoginFormData> label="å¯†ç " name="password">
        <Input type="password" />
      </FormItem>
    </Form>
  );
}
```

## ğŸ¯ çŠ¶æ€ç®¡ç†

### ä½¿ç”¨ Context è¿›è¡ŒçŠ¶æ€ç®¡ç†

```tsx
import React, { createContext, useContext, useState } from "react";

interface AppState {
  user: User | null;
  theme: "light" | "dark";
}

interface AppContextType {
  state: AppState;
  setUser: (user: User | null) => void;
  setTheme: (theme: "light" | "dark") => void;
}

const AppContext = createContext<AppContextType | undefined>(undefined);

export const AppProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [state, setState] = useState<AppState>({
    user: null,
    theme: "light"
  });

  const setUser = (user: User | null) => {
    setState((prev) => ({ ...prev, user }));
  };

  const setTheme = (theme: "light" | "dark") => {
    setState((prev) => ({ ...prev, theme }));
  };

  return <AppContext.Provider value={{ state, setUser, setTheme }}>{children}</AppContext.Provider>;
};

export const useApp = () => {
  const context = useContext(AppContext);
  if (!context) {
    throw new Error("useApp must be used within AppProvider");
  }
  return context;
};
```

## ğŸ”„ æ•°æ®è·å–

### ä½¿ç”¨è‡ªå®šä¹‰ Hook å°è£…æ•°æ®è¯·æ±‚

```tsx
import { useState, useEffect } from "react";

interface UseApiOptions {
  immediate?: boolean;
}

function useApi<T>(apiFn: () => Promise<T>, options: UseApiOptions = {}) {
  const { immediate = true } = options;
  const [data, setData] = useState<T | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<Error | null>(null);

  const execute = async () => {
    setLoading(true);
    setError(null);
    try {
      const result = await apiFn();
      setData(result);
      return result;
    } catch (err) {
      setError(err as Error);
      throw err;
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    if (immediate) {
      execute();
    }
  }, []);

  return { data, loading, error, execute };
}

// ä½¿ç”¨ç¤ºä¾‹
function UserList() {
  const { data, loading, error } = useApi(() => fetchUsers());

  if (loading) return <Loading loading />;
  if (error) return <div>Error: {error.message}</div>;
  if (!data) return null;

  return (
    <div>
      {data.map((user) => (
        <div key={user.id}>{user.name}</div>
      ))}
    </div>
  );
}
```

## ğŸ¨ æ ·å¼ç®¡ç†

### ä½¿ç”¨ CSS Modules

```tsx
// UserCard.module.scss
.card {
  padding: var(--td-spacing-4);
  border: 1px solid var(--td-border-color);
  border-radius: var(--td-border-radius-default);

  &:hover {
    box-shadow: var(--td-shadow-2);
  }
}

.title {
  font-size: var(--td-font-size-l);
  font-weight: var(--td-font-weight-semibold);
  color: var(--td-text-color-primary);
}

// UserCard.tsx
import React from 'react';
import styles from './UserCard.module.scss';

function UserCard({ user }) {
  return (
    <div className={styles.card}>
      <h3 className={styles.title}>{user.name}</h3>
      <p>{user.email}</p>
    </div>
  );
}
```

### ä½¿ç”¨ classnames åº“

```tsx
import React from "react";
import classNames from "classnames";
import styles from "./Button.module.scss";

interface CustomButtonProps {
  variant?: "primary" | "secondary";
  size?: "small" | "medium" | "large";
  active?: boolean;
}

function CustomButton({ variant = "primary", size = "medium", active }: CustomButtonProps) {
  return (
    <button
      className={classNames(styles.button, styles[`button--${variant}`], styles[`button--${size}`], {
        [styles["button--active"]]: active
      })}
    >
      Click me
    </button>
  );
}
```

## ğŸ§ª æµ‹è¯•

### ç»„ä»¶æµ‹è¯•

```tsx
import { render, fireEvent, waitFor } from "@testing-library/react";
import { Form, FormItem, Input, Button } from "tendaui-react";

describe("LoginForm", () => {
  it("submits form with valid data", async () => {
    const onSubmit = jest.fn();
    const { getByLabelText, getByRole } = render(
      <Form onSubmit={onSubmit}>
        <FormItem label="Username" name="username">
          <Input />
        </FormItem>
        <FormItem label="Password" name="password">
          <Input type="password" />
        </FormItem>
        <Button type="submit">Submit</Button>
      </Form>
    );

    fireEvent.change(getByLabelText("Username"), {
      target: { value: "testuser" }
    });
    fireEvent.change(getByLabelText("Password"), {
      target: { value: "password123" }
    });
    fireEvent.click(getByRole("button", { name: "Submit" }));

    await waitFor(() => {
      expect(onSubmit).toHaveBeenCalledWith(
        expect.objectContaining({
          fields: {
            username: "testuser",
            password: "password123"
          }
        })
      );
    });
  });
});
```

## ğŸ“± å“åº”å¼è®¾è®¡

### ä½¿ç”¨åª’ä½“æŸ¥è¯¢

```scss
// responsive.scss
.container {
  padding: var(--td-spacing-4);

  @media (max-width: 768px) {
    padding: var(--td-spacing-2);
  }

  @media (min-width: 1200px) {
    padding: var(--td-spacing-6);
  }
}
```

### å“åº”å¼ç»„ä»¶

```tsx
import React from "react";
import { useWindowSize } from "tendaui-react/hooks";

function ResponsiveComponent() {
  const { width } = useWindowSize();
  const isMobile = width < 768;

  return <div>{isMobile ? <MobileLayout /> : <DesktopLayout />}</div>;
}
```

## ğŸŒ å›½é™…åŒ–

### ä½¿ç”¨ i18n

```tsx
import React from "react";
import { ConfigProvider } from "tendaui-react";
import zhCN from "tendaui-react/es/locale/zh_CN";
import enUS from "tendaui-react/es/locale/en_US";

function App() {
  const [locale, setLocale] = React.useState("zh-CN");

  const localeMap = {
    "zh-CN": zhCN,
    "en-US": enUS
  };

  return <ConfigProvider locale={localeMap[locale]}>{/* ä½ çš„åº”ç”¨ */}</ConfigProvider>;
}
```

## âš¡ æ€§èƒ½ç›‘æ§

### ä½¿ç”¨ React DevTools Profiler

```tsx
import React, { Profiler } from "react";

function onRenderCallback(id: string, phase: "mount" | "update", actualDuration: number) {
  console.log(`${id}'s ${phase} phase took ${actualDuration}ms`);
}

function App() {
  return (
    <Profiler id="App" onRender={onRenderCallback}>
      {/* ä½ çš„åº”ç”¨ */}
    </Profiler>
  );
}
```

## ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ

### é˜²æ­¢ XSS æ”»å‡»

```tsx
import React from "react";

// âŒ ä¸æ¨èï¼šç›´æ¥æ¸²æŸ“ HTML
function UnsafeComponent({ html }) {
  return <div dangerouslySetInnerHTML={{ __html: html }} />;
}

// âœ… æ¨èï¼šä½¿ç”¨æ–‡æœ¬å†…å®¹
function SafeComponent({ text }) {
  return <div>{text}</div>;
}

// âœ… å¦‚æœå¿…é¡»æ¸²æŸ“ HTMLï¼Œå…ˆè¿›è¡Œæ¸…ç†
import DOMPurify from "dompurify";

function SaferComponent({ html }) {
  const cleanHtml = DOMPurify.sanitize(html);
  return <div dangerouslySetInnerHTML={{ __html: cleanHtml }} />;
}
```

---

<div
  style={{
    padding: "24px",
    background: "#f0f9ff",
    border: "1px solid #91caff",
    borderRadius: "8px",
    marginTop: "48px"
  }}
>
  <h3 style={{ marginTop: 0 }}>ğŸ’¡ æŒç»­æ”¹è¿›</h3>
  <p>è¿™äº›æœ€ä½³å®è·µä¼šéšç€é¡¹ç›®çš„å‘å±•è€Œä¸æ–­æ›´æ–°ã€‚å¦‚æœä½ æœ‰æ›´å¥½çš„å»ºè®®ï¼Œæ¬¢è¿è´¡çŒ®ï¼</p>
</div>
